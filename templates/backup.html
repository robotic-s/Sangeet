<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood-Enhancing Music Player</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary-color: #5B8C5A;
            --secondary-color: #92B4A7;
            --text-color: #2C3E50;
            --background-color: #F0F4F8;
            --card-color: #FFFFFF;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --accent-color: #F9A825;
            --progress-bg: #D1E8E2;
        }

        .dark-mode {
            --primary-color: #78A5A3;
            --secondary-color: #B9D7D9;
            --text-color: #E0E0E0;
            --background-color: #2C3E50;
            --card-color: #34495E;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --accent-color: #F4D03F;
            --progress-bg: #465C6E;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }



        body::-webkit-scrollbar{
            width : 0;
        }

        #app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 80px;
        }

        #search-container {
            position: sticky;
            top: 0;
            z-index: 10;
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: var(--background-color);
        }

        #search-input {
            flex-grow: 1;
            padding: 10px;
            border: none;
            border-radius: 20px;
            background-color: var(--card-color);
            color: var(--text-color);
            font-size: 16px;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        #filter-button,
        #history-button,
        #theme-toggle {
            margin-left: 10px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
        }

        #songs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }

        .song-card {
            background-color: var(--card-color);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .song-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px var(--shadow-color);
        }

        .song-card img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
        }

        .song-info {
            padding: 15px;
        }

        .song-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 1em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--primary-color);
        }

        .song-artist {
            font-size: 0.8em;
            color: var(--secondary-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #mini-player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-color);
            padding: 10px;
            display: flex;
            align-items: center;
            box-shadow: 0 -2px 10px var(--shadow-color);
            z-index: 100;
            margin-bottom: 1%;
        }

        #mini-player-artwork {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
        }

        #mini-player-info {
            flex-grow: 1;
            min-width: 0;
            overflow: hidden;
        }

        #mini-player-artist {
            color: var(--secondary-color);
            font-size: 0.8em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #mini-progress-container {
            height: 4px;
            background-color: var(--progress-bg);
            margin-top: 5px;
            border-radius: 2px;
            overflow: hidden;
        }

        #mini-progress-bar {
            height: 100%;
            background-color: var(--accent-color);
            width: 0;
        }

        #full-player {
            position: fixed;
            top: 5%;
            left: 5%;
            right: 5%;
            bottom: 5%;
            background-color: var(--card-color);
            display: none;
            flex-direction: column;
            padding: 20px;
            z-index: 1000;
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow-color);
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        #full-player::-webkit-scrollbar {
            width: 0px;
        }

        #full-player.active {
            display: flex;
        }

        #close-button {
            position: sticky;
            top: 0;
            align-self: flex-end;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
            z-index: 1;
        }

        #full-player-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #full-player-artwork {
            width: 100%;
            max-width: 300px;
            aspect-ratio: 1;
            object-fit: cover;
            border-radius: 10px;
            margin: 20px auto;
            box-shadow: 0 4px 10px var(--shadow-color);
        }

        #full-player-artist {
            text-align: center;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }

        #full-progress-container {
            width: 100%;
            background-color: var(--progress-bg);
            height: 6px;
            border-radius: 3px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        #full-progress-bar {
            height: 100%;
            background-color: var(--accent-color);
            border-radius: 3px;
            width: 0;
        }

        #time-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            margin-bottom: 20px;
            width: 100%;
            color: var(--text-color);
        }

        #player-controls {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .control-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            margin: 0 15px;
            transition: color 0.3s;
        }

        .control-btn:hover {
            color: var(--accent-color);
        }

        #song-details {
            background-color: var(--background-color);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            width: 100%;
        }

        #song-details h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        #song-details p {
            margin-bottom: 10px;
            font-size: 0.9em;
            color: var(--text-color);
        }

        .marquee-container {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
        }

        .marquee-content {
            display: inline-block;
            white-space: nowrap;
            animation: marquee 15s linear infinite;
        }

        .marquee-content span {
            display: inline-block;
            padding-right: 50px;
        }

        @keyframes marquee {
            0% {
                transform: translate3d(0, 0, 0);
            }

            100% {
                transform: translate3d(-50%, 0, 0);
            }
        }

        #filter-panel {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 300px;
            background-color: var(--card-color);
            padding: 20px;
            box-shadow: -2px 0 10px var(--shadow-color);
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease-in-out;
        }

        #filter-panel.active {
            display: block;
            transform: translateX(0);
        }

        .filter-section {
            margin-bottom: 20px;
        }

        .filter-section h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .filter-section h3 .material-icons {
            margin-right: 10px;
        }

        .filter-slider {
            width: 100%;
            --webkit-appearance: none;
            height: 5px;
            border-radius: 5px;
            background: var(--progress-bg);
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .filter-slider:hover {
            opacity: 1;
        }

        .filter-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
        }

        .filter-slider::-moz-range-thumb {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
        }

        .filter-checkbox {
            display: none;
        }

        .filter-checkbox+label {
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 15px;
            background-color: var(--background-color);
            color: var(--text-color);
            display: inline-block;
            margin-right: 5px;
            margin-bottom: 5px;
            transition: background-color 0.3s, color 0.3s;
        }

        .filter-checkbox:checked+label {
            background-color: var(--accent-color);
            color: var(--card-color);
        }

        #close-filter-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
        }

        #apply-filters-btn {
            width: 100%;
            padding: 10px;
            background-color: var(--accent-color);
            color: var(--card-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        #apply-filters-btn:hover {
            background-color: var(--primary-color);
        }

        #listening-history-panel {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 300px;
            background-color: var(--card-color);
            padding: 20px;
            box-shadow: -2px 0 10px var(--shadow-color);
            overflow-y: auto;
            z-index: 1000;
        }

        #listening-history-panel.active {
            display: block;
        }

        .history-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .history-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 15px;
        }

        .history-info {
            flex-grow: 1;
            min-width: 0;
            overflow: hidden;
        }

        .history-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 1em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-artist {
            font-size: 0.8em;
            color: var(--secondary-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-stats-link {
            font-size: 0.8em;
            color: var(--accent-color);
            text-decoration: none;
            cursor: pointer;
        }

        #close-history-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
        }

        #song-stats-content {
            background-color: var(--background-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #song-stats-content h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
            font-size: 1.5em;
        }

        .stats-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            width: 100%;
        }

        .stats-item .material-icons {
            margin-right: 10px;
            color: var(--secondary-color);
            font-size: 24px;
        }

        .stats-item p {
            margin: 0;
            font-size: 1em;
            color: var(--text-color);
        }

        .stats-item p span {
            font-weight: bold;
        }

        #listening-trend-chart {
            margin-top: 30px;
            width: 100%;
            max-width: 600px;
        }

        .history-list {
            list-style-type: none;
            padding: 0;
            margin-top: 20px;
            width: 100%;
        }

        .history-list li {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: var(--card-color);
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .history-list li .material-icons {
            margin-right: 10px;
            color: var(--secondary-color);
        }

        .history-list li span {
            font-size: 0.9em;
            color: var(--text-color);
        }

        .beat-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .beat-bar {
    position: absolute;
    bottom: 0;
    width: 4px;
    background-color: rgba(91, 140, 90, 0.3);
    border-radius: 2px 2px 0 0;
    margin-right: 2px;
    transition: height 0.3s ease-out, opacity 0.3s ease-out;
}

.beat-bar.hidden {
    height: 0 !important;
    opacity: 0;
}

.dark-mode .beat-bar {
    background-color: rgba(120, 165, 163, 0.3);
}

       

        .beat-bar {
            /* ... existing styles ... */
            will-change: height;
            /* Hint to the browser for optimization */
            transform: translateZ(0);
            /* Trigger GPU acceleration */
        }

        @keyframes marquee {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        #youtube-results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .youtube-result {
            background-color: var(--card-color);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .youtube-result:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px var(--shadow-color);
        }

        .youtube-result img {
            width: 100%;
            aspect-ratio: 16 / 9;
            object-fit: cover;
        }

        .youtube-result .song-info {
            padding: 15px;
        }

        .youtube-result .song-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 1em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--primary-color);
        }

        .youtube-result .song-artist {
            font-size: 0.8em;
            color: var(--secondary-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .youtube-result .play-now-btn {
            width: 100%;
            padding: 10px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .youtube-result .play-now-btn:hover {
            background-color: var(--accent-color);
        }

        #stats-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .stats-content {
            background-color: var(--card-color);
            border-radius: 15px;
            padding: 30px;
            margin: 50px auto;
            max-width: 800px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.3s ease-out;
            position: relative;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
        }

        .stats-title {
            font-size: 24px;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .stats-artist {
            font-size: 18px;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stats-card {
            background-color: var(--background-color);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-5px);
        }

        .stats-card i {
            font-size: 36px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .stats-card span {
            font-size: 24px;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .stats-card p {
            font-size: 14px;
            color: var(--secondary-color);
        }

        .history-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        #stats-history-list {
            list-style-type: none;
            padding: 0;
        }

        #stats-history-list li {
            background-color: var(--background-color);
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1001;
            background-color: var(--card-color);
            color: var(--text-color);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin: 0 5px;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .dot-1 {
            background-color: #FF6B6B;
            animation-delay: -0.32s;
        }

        .dot-2 {
            background-color: #4ECDC4;
            animation-delay: -0.16s;
        }

        .dot-3 {
            background-color: #45B7D1;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1.0);
            }
        }

        .searching-text {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary-color);
        }

        @keyframes ellipsis {
            0% {
                content: '.';
            }

            33% {
                content: '..';
            }

            66% {
                content: '...';
            }

            100% {
                content: '.';
            }
        }

        .searching-text::after {
            content: '.';
            animation: ellipsis 1.5s infinite;
        }

        .dark-mode .dot-1 {
            background-color: #FF9FF3;
        }

        .dark-mode .dot-2 {
            background-color: #54A0FF;
        }

        .dark-mode .dot-3 {
            background-color: #5ED4F3;
        }

        @media (max-width: 768px) {
            #youtube-results-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            #full-player {
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                border-radius: 0;
            }

            #full-player-artwork {
                max-width: 200px;
            }

            #player-controls {
                flex-wrap: wrap;
            }

            .control-btn {
                margin: 10px;
            }

            .beat-bar {
                width: 3px;
            }

            .stats-content {
                margin: 20px;
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        @media (max-width: 480px) {
            #youtube-results-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }

            #mini-player-artwork {
                width: 40px;
                height: 40px;
            }

            #full-player-artwork {
                max-width: 150px;
            }

            #full-player-title {
                font-size: 1.2em;
            }

            #song-details {
                font-size: 0.8em;
            }

            .stats-content {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stats-card {
                padding: 15px;
            }

            .stats-card i {
                font-size: 28px;
            }

            .stats-card span {
                font-size: 20px;
            }
        }

        .search-input-wrapper {
            position: relative;
            flex-grow: 1;
            display: flex;
            align-items: center;
        }

        #search-input {
            padding-right: 30px;
            /* Make room for the clear button */
        }

        .clear-search-btn {
            position: absolute;
            right: 5px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
            display: none;
            /* Hide by default */
        }

        .clear-search-btn:hover {
            color: var(--accent-color);
        }
    </style>
    <style>
        .music-stats-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px 0;
            font-family: 'Arial', sans-serif;
            background-color: var(--background-color, #F0F4F8);
        }

        .music-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 30px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .music-stat:hover {
            transform: scale(1.1);
        }

        .music-stat-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .music-stat-icon img {
            width: 24px;
            height: 24px;
        }

        .music-stat-info {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-color, #2C3E50);
        }

        .music-stat-label {
            font-size: 12px;
            color: var(--secondary-color, #7F8C8D);
        }
    </style>
    <style>
        .no-results-message {
            text-align: center;
            font-size: 24px;
            color: var(--text-color);
            margin-top: 50px;
            opacity: 0;
            animation: fadeIn 0.5s ease-in-out forwards;
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
    <style>
        .logo-container {
            display: flex;
            align-items: baseline;
            gap: 15px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            padding-bottom: 2px;
        }

        .logo::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            border-radius: 1px;
        }

        .musical-note {
            display: inline-block;
            transform: translateY(-2px);
            color: #ff6b6b;
        }

        .byline {
            font-size: 14px;
            color: #666;
            font-style: italic;
        }
    </style>
    <style>
        .share-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.3s;
            background: none;
            padding: 0;
            margin-left: 10px;
            /* Adjust as needed to align with other buttons */
        }

        .share-button:hover {
            transform: scale(1.1);
        }

        .share-button .material-icons {
            font-size: 24px;
            color: #4CAF50;
            /* Adjust color as needed to match your design */
        }
    </style>
    <style>
        .star {
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 24px;
        }

        .star:hover,
        .star.active {
            color: #FFD700;
            transform: scale(1.2);
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
    </style>
    <style>
        .history-actions {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }

        .history-play-link {
            color: #4CAF50;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
        }

        .history-play-link:hover {
            color: #45a049;
        }

        .history-play-link .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .history-play-link .error-icon {
            display: none;
            color: #e74c3c;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
    <style>
        /* ... (previous styles) ... */

        @keyframes ellipsis {
            0% {
                content: '';
            }

            25% {
                content: '.';
            }

            50% {
                content: '..';
            }

            75% {
                content: '...';
            }

            100% {
                content: '';
            }
        }

        .adding-to-sangeet {
            position: relative;
        }

        .adding-to-sangeet::after {
            content: '';
            display: inline-block;
            width: 20px;
            animation: ellipsis 1.5s infinite;
        }
    </style>
    <style>
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes wave {

            0%,
            100% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(20deg);
            }

            75% {
                transform: rotate(-20deg);
            }
        }

        #greeting-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            animation: fadeIn 1s ease-out forwards, fadeOut 1s ease-in forwards 5s;
        }

        #greeting-content {
            text-align: center;
            color: #fff;
            font-family: 'Arial', sans-serif;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            max-width: 80%;
        }

        #greeting-icon {
            font-size: 100px;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        #greeting-text {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        #greeting-subtext {
            font-size: 24px;
            opacity: 0.9;
            max-width: 80%;
            margin: 0 auto;
        }

        .decoration {
            position: absolute;
            opacity: 0.2;
        }

        .circle {
            border-radius: 50%;
            background-color: #fff;
        }

        .square {
            background-color: #fff;
        }

        .music-note {
            font-size: 24px;
            position: absolute;
            animation: float 4s ease-in-out infinite;
        }

        /* Time-specific styles */
        .morning {
            background: linear-gradient(135deg, #FF9A8B 0%, #FF6A88 100%);
        }

        .morning .decoration {
            background-color: #FFD700;
        }

        .noon {
            background: linear-gradient(135deg, #FFC837 0%, #FF8008 100%);
        }

        .noon .decoration {
            background-color: #FF4500;
        }

        .afternoon {
            background: linear-gradient(135deg, #4ECDC4 0%, #45B7D1 100%);
        }

        .afternoon .decoration {
            background-color: #00CED1;
        }

        .evening {
            background: linear-gradient(135deg, #3A1C71 0%, #D76D77 50%, #FFAF7B 100%);
        }

        .evening .decoration {
            background-color: #FF1493;
        }

        .night {
            background: linear-gradient(135deg, #0F2027 0%, #203A43 50%, #2C5364 100%);
        }

        .night .decoration {
            background-color: #00FFFF;
        }
    </style>
    <style>
        #youtube-link-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--card-color);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        #youtube-link-popup.hidden {
            display: none;
        }


        #youtube-link-popup h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        #youtube-link-popup p {
            color: var(--text-color);
            margin-bottom: 20px;
        }

        .popup-buttons {
            display: flex;
            justify-content: space-between;
        }

        #youtube-link-popup button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }

        #youtube-link-popup button:active {
            transform: scale(0.95);
        }

        #not-now-btn {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        #sure-btn {
            background-color: var(--accent-color);
            color: white;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-color);
            cursor: pointer;
        }
    </style>
    <style>
        /* Show Mode Panel Styles */
        #show-mode-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(240, 244, 248, 0.8);
            /* Light mode background */
            color: #2C3E50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1999;
            /* Lowered z-index to be below the header */
            padding: 20px;
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        #show-mode-panel.hidden {
            display: none;
        }

        /* Ensure header stays visible */
        #sticky-header {
            z-index: 2001;
            /* Increased z-index to be above show mode panel */
        }

        #search-container {
            z-index: 2000;
            /* Also increased to be above show mode panel */
        }

        /* Hide other elements when show mode is active, except header, search container, and beat container */
        body.show-mode-active>*:not(#sticky-header):not(#search-container):not(#show-mode-panel):not(.beat-container) {
            display: none !important;
        }

        /* Rest of the CSS remains the same */
        #show-mode-artwork {
            width: 80%;
            max-width: 300px;
            height: auto;
            aspect-ratio: 16 / 9;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        #show-mode-song-info {
            width: 100%;
            text-align: center;
            margin-top: 20px;
        }

        #show-mode-title-container {
            width: 100%;
            overflow: hidden;
            margin-bottom: 10px;
        }

        #show-mode-title {
            font-size: 24px;
            color: #5B8C5A;
            white-space: nowrap;
            animation: marquee 20s linear infinite;
        }

        @keyframes marquee {
            0% {
                transform: translateX(100%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        #show-mode-artist {
            font-size: 18px;
            color: #92B4A7;
            margin-bottom: 20px;
        }

        #close-show-mode-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: #5B8C5A;
            cursor: pointer;
            font-size: 36px;
        }

        /* Dark mode adjustments */
        .dark-mode #show-mode-panel {
            background-color: rgba(44, 62, 80, 0.8);
            color: #E0E0E0;
        }

        .dark-mode #show-mode-title {
            color: #78A5A3;
        }

        .dark-mode #show-mode-artist {
            color: #B9D7D9;
        }

        .dark-mode #close-show-mode-btn {
            color: #78A5A3;
        }

        /* Responsive design */
        @media screen and (max-width: 768px) {
            #show-mode-artwork {
                width: 90%;
                max-width: 250px;
            }

            #show-mode-title {
                font-size: 20px;
            }

            #show-mode-artist {
                font-size: 16px;
            }

            #close-show-mode-btn {
                font-size: 28px;
            }
        }

        @media screen and (max-width: 480px) {
            #show-mode-artwork {
                width: 95%;
                max-width: 200px;
            }

            #show-mode-title {
                font-size: 18px;
            }

            #show-mode-artist {
                font-size: 14px;
            }

            #close-show-mode-btn {
                font-size: 24px;
                top: 10px;
                right: 10px;
            }
        }

        /* Landscape orientation for mobile devices */
        @media screen and (max-height: 500px) and (orientation: landscape) {
            #show-mode-panel {
                flex-direction: row;
                justify-content: space-around;
                align-items: center;
            }

            #show-mode-artwork {
                width: 40%;
                max-width: none;
                margin-bottom: 0;
                margin-right: 20px;
            }

            #show-mode-song-info {
                width: 50%;
                text-align: left;
            }

            #show-mode-title-container {
                margin-bottom: 5px;
            }

            #show-mode-artist {
                margin-bottom: 10px;
            }

            #close-show-mode-btn {
                top: 10px;
                right: 10px;
            }
        }

        .beat-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .beat-bar {
            position: absolute;
            bottom: 0;
            width: 4px;
            background-color: rgba(91, 140, 90, 0.3);
            transition: height 0.05s ease-out;
            border-radius: 2px 2px 0 0;
            margin-right: 2px;
        }

        .dark-mode .beat-bar {
            background-color: rgba(120, 165, 163, 0.3);
        }
    </style>
    <style>
        #search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--card-color);
            border: 1px solid var(--secondary-color);
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-suggestion {
            padding: 10px;
            cursor: pointer;
        }

        .search-suggestion:hover {
            background-color: var(--secondary-color);
        }
    </style>
    <style>
        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            flex-grow: 1;
        }

        #search-input {
            width: 100%;
            padding: 10px;
            padding-right: 80px;
            /* Make room for both buttons */
            border: none;
            border-radius: 20px;
            background-color: var(--card-color);
            color: var(--text-color);
            font-size: 16px;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .clear-search-btn {
            position: absolute;
            right: 40px;
            /* Position it to the left of the search button */
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
            display: none;
            /* Hide by default */
        }

        .search-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
        }

        .clear-search-btn:hover,
        .search-btn:hover {
            color: var(--accent-color);
        }

        #search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--card-color);
            border: 1px solid var(--secondary-color);
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
    </style>
    <style>
        /* Marquee styles for both desktop and mobile */
        .marquee-container {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
        }

        .marquee-content {
            display: inline-block;
            white-space: nowrap;
            animation: marquee 15s linear infinite;
        }

        .marquee-content span {
            display: inline-block;
            padding-right: 50px;
        }

        @keyframes marquee {
            0% {
                transform: translate3d(0, 0, 0);
            }

            100% {
                transform: translate3d(-100%, 0, 0);
            }
        }

        /* Mini player styles */
        #mini-player-info {
            flex-grow: 1;
            min-width: 0;
            overflow: hidden;
        }

        #mini-player-title {
            font-weight: 600;
            font-size: 1em;
            color: var(--primary-color);
        }

        /* Full player styles */
        #full-player-title {
            font-weight: 600;
            font-size: 1.2em;
            color: var(--primary-color);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {

            #mini-player-title,
            #full-player-title {
                font-size: 0.9em;
            }
        }

        @media (max-width: 480px) {

            #mini-player-title,
            #full-player-title {
                font-size: 0.8em;
            }
        }
    </style>
    <style>
        .history-list {
            list-style-type: none;
            padding: 0;
            margin-top: 20px;
            width: 100%;
        }

        .history-list li {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: var(--card-color);
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .history-list li .material-icons {
            margin-right: 10px;
            color: var(--secondary-color);
        }

        .history-list li span {
            font-size: 0.9em;
            color: var(--text-color);
        }

        #view-more-history {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #view-more-history:hover {
            background-color: var(--accent-color);
        }
    </style>
    <style>
        .history-delete-link {
            color: #e74c3c;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            margin-left: 10px;
        }

        .history-delete-link:hover {
            color: #c0392b;
        }
    </style>
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: var(--card-color);
            margin: 15% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.3s;
        }

        .modal h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .modal p {
            color: var(--text-color);
            margin-bottom: 30px;
        }

        .modal-buttons {
            display: flex;
            justify-content: space-around;
        }

        .modal-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .modal-button.cancel {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .modal-button.confirm {
            background-color: #e74c3c;
            color: white;
        }

        .modal-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
    <style>
        .caution-pane {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .caution-content {
            background-color: #fff;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .caution-content h2 {
            color: #ff6b6b;
            text-align: center;
            margin-bottom: 20px;
        }

        .caution-content p,
        .caution-content ul {
            color: #333;
            line-height: 1.6;
        }

        .caution-content ul {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        .agreement-box {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            border: 2px solid #4ecdc4;
            border-radius: 10px;
            background-color: #f0f8ff;
        }

        .agreement-box input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.5);
        }

        .agreement-box label {
            color: #333;
            font-weight: bold;
        }

        #understandButton {
            display: block;
            width: 200px;
            margin: 20px auto 0;
            padding: 10px;
            background-color: #4ecdc4;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s, opacity 0.3s;
        }

        #understandButton:hover:not(:disabled) {
            background-color: #45b7d1;
        }

        #understandButton:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .caution-pane ::-webkit-scrollbar {
            width: 0;
        }
    </style>
    <style>
        #settings-button {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            margin-left: 10px;
        }

        .settings-panel {
    position: fixed;
    top: 0;
    right: -100%;
    width: 100%;
    max-width: 400px;
    height: 100%;
    background-color: var(--card-color);
    box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
    transition: right 0.3s ease-in-out;
    z-index: 1000;
    overflow-y: auto;
    scrollbar-width: none; /* For Firefox */
    -ms-overflow-style: none; /* For Internet Explorer and Edge */
}

.settings-panel::-webkit-scrollbar {
    width: 0px;
    background: transparent; /* For Chrome, Safari, and Opera */
}

        .settings-panel.active {
            right: 0;
        }

        .settings-content {
            padding: 20px;
            position: relative;
        }

        .settings-content h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }

        input:checked+.slider {
            background-color: var(--accent-color);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        .settings-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        #visualizer-style {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid var(--secondary-color);
            background-color: var(--card-color);
            color: var(--text-color);
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-color);
            cursor: pointer;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: var(--card-color);
            margin: 15% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
            text-align: center;
        }

        .modal-buttons {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .modal-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .modal-button.cancel {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .modal-button.confirm {
            background-color: var(--accent-color);
            color: white;
        }
    </style>
    <style>
        .cleanup-spinner {
            border: 4px solid var(--secondary-color);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: cleanup-spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes cleanup-spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
    <style>
        :root {
            --primary-color: #5B8C5A;
            --secondary-color: #92B4A7;
            --text-color: #2C3E50;
            --background-color: #F0F4F8;
            --card-color: #FFFFFF;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --accent-color: #F9A825;
        }

        .dark-mode {
            --primary-color: #78A5A3;
            --secondary-color: #B9D7D9;
            --text-color: #E0E0E0;
            --background-color: #2C3E50;
            --card-color: #34495E;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --accent-color: #F4D03F;
        }

        @keyframes colorChange {

            0%,
            100% {
                color: #ff6b6b;
            }

            20% {
                color: #feca57;
            }

            40% {
                color: #48dbfb;
            }

            60% {
                color: #ff9ff3;
            }

            80% {
                color: #54a0ff;
            }
        }

        @keyframes glow {

            0%,
            100% {
                text-shadow: 0 0 5px rgba(255, 255, 255, 0.8), 0 0 10px currentColor;
            }

            50% {
                text-shadow: 0 0 20px rgba(255, 255, 255, 0.8), 0 0 30px currentColor;
            }
        }

        @keyframes bassEffect {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        @keyframes lightPulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        #sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background-color: var(--background-color);
            padding: 10px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            z-index: 2;
        }

        .logo-text {
            position: relative;
            display: inline-block;
            padding: 0 10px;
        }

        .byline {
            font-size: 14px;
            color: var(--secondary-color);
            font-style: italic;
            z-index: 2;
            margin-left: 10px;
        }

        .logo::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff);
            border-radius: 1px;
            transition: all 0.3s ease;
        }

        .musical-note {
            display: inline-block;
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }

        .logo-container:not(.playing) .logo {
            animation: colorChange 10s infinite, glow 2s ease-in-out infinite;
        }

        .logo-container:not(.playing) .musical-note {
            animation: colorChange 10s infinite 0.5s;
        }

        .logo-container.playing .logo {
            animation: bassEffect 0.5s ease-in-out infinite, colorChange 5s infinite;
        }

        .logo-container.playing .musical-note {
            animation: lightPulse 0.5s ease-in-out infinite, colorChange 5s infinite 0.25s;
        }

        .logo-container.playing .logo::after {
            animation: lightPulse 0.5s ease-in-out infinite, colorChange 5s infinite 0.5s;
        }

        .logo-container.playing .byline {
            animation: lightPulse 1s ease-in-out infinite;
        }

        .header-beat-container {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            align-items: center;
            pointer-events: none;
            z-index: 1;
        }

        .header-beat-bar {
            width: 2px;
            background-color: var(--primary-color);
            opacity: 0.7;
            transition: height 0.1s ease-out;
            border-radius: 1px;
            margin: 0 1px;
            flex-grow: 1;
        }

        .dark-mode .header-beat-bar {
            background-color: var(--secondary-color);
        }

        #app-container {
            padding-top: 80px;
        }

        #search-container {
            position: sticky;
            top: 80px;
            z-index: 999;
            background-color: var(--background-color);
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            #sticky-header {
                padding: 5px 10px;
            }

            .logo {
                font-size: 24px;
            }

            .byline {
                font-size: 12px;
            }

            #app-container {
                padding-top: 60px;
            }

            #search-container {
                top: 60px;
            }
        }
    </style>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

#lyrics-container {
    width: 90%;
    max-height: 400px;
    overflow-y: auto;
    margin-top: 20px;
    padding: 20px;
    background-color: var(--card-color);
    border-radius: 15px;
    box-shadow: 0 4px 15px var(--shadow-color);
    transition: all 0.3s ease;
    font-family: 'Poppins', sans-serif;
}

#lyrics-container h3 {
    position: sticky;
    top: 0;
    padding: 10px 0;
    margin: 0 0 10px 0;
    font-size: 24px;
    color: var(--primary-color);
    text-align: center;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
}

#lyrics-container h3::before {
    content: '';
    margin-right: 10px;
    font-size: 28px;
}

#lyrics-content {
    white-space: pre-wrap;
    font-size: 30px;
    line-height: 1.8;
    text-align: center;
    padding-top: 10px;
}

#lyrics-source {
    font-size: 40px;
    color: var(--secondary-color);
    text-align: right;
    margin-top: 15px;
    font-style: italic;
}

/* Hide scrollbar */
#lyrics-container::-webkit-scrollbar {
    width: 0;
    background: transparent;
}

#lyrics-container {
    -ms-overflow-style: none;
    scrollbar-width: none;
}

/* Gradient fade effect */
#lyrics-container::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 30px;
    background: linear-gradient(to top, var(--card-color), transparent);
    pointer-events: none;
}

/* Multicolor text effect */
@keyframes multicolorText {
    0% { color: #FF5733; }
    20% { color: #33FF57; }
    40% { color: orange }
    60% { color: #FF33F5; }
    80% { color: #FFD700; }
    100% { color: #FF5733; }
}

#lyrics-content {
    animation: fadeIn 0.5s ease-out, multicolorText 10s infinite;
}

/* Fade in animation */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Dark mode adjustments */
.dark-mode #lyrics-container h3 {
    color: var(--accent-color);
}

.dark-mode #lyrics-source {
    color: var(--secondary-color);
}

.dark-mode #lyrics-container::after {
    background: linear-gradient(to top, var(--card-color), transparent);
}

/* Responsive design */
@media (max-width: 768px) {
    #lyrics-container {
        width: 90%;
    }

    #lyrics-container h3 {
        font-size: 20px;
    }

    #lyrics-content {
        font-size: 16px;
    }

    #lyrics-source {
        font-size: 12px;
    }
}
    </style>
    <style>
        .sangeet-info {
    margin-top: 30px;
    text-align: center;
    padding-top: 20px;
}

.sangeet-info h3 {
    font-size: 32px; /* Increased font size */
    font-weight: bold;
    color: var(--primary-color);
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 2px;
}

.sangeet-info .version {
    font-size: 18px; /* Increased font size */
    font-weight: bold;
    color: var(--accent-color);
    margin-bottom: 25px;
}
     


.detailed-info {
    background-color: rgba(200, 200, 200, 0.1);
    border-radius: 20px;
    padding: 20px;
    margin-top: 20px;
    text-align: left;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: background-color 0.3s ease;
}

.dark-mode .detailed-info {
    background-color: rgba(50, 50, 50, 0.2);
}

.detailed-info h4 {
    font-size: 18px;
    color: var(--primary-color);
    margin-bottom: 10px;
}

.detailed-info p {
    font-size: 14px;
    color: var(--text-color);
    margin-bottom: 15px;
    line-height: 1.5;
}

.detailed-info ul {
    list-style-type: none;
    padding-left: 0;
}

.detailed-info li {
    font-size: 14px;
    color: var(--text-color);
    margin-bottom: 5px;
    padding-left: 20px;
    position: relative;
}

.detailed-info li::before {
    content: '';
    position: absolute;
    left: 0;
    color: var(--accent-color);
}
    </style>
    <style>
        .separator {
    width: 100%;
    height: 10px; /* Increased height for larger dots */
    margin: 30px 0;
    background-image: radial-gradient(circle, var(--accent-color) 1px, transparent 1px);
    background-size: 10px 10px; /* Increased size for larger dots */
    background-position: center;
    opacity: 0.7;
    transition: opacity 0.3s ease;
}

.dark-mode .separator {
    opacity: 0.5;
}
.dark-mode .separator {
    background-image: radial-gradient(circle, var(--accent-color) 1px, transparent 1px);
}

.dark-mode .sangeet-info h3 {
    color: var(--accent-color);
}

.dark-mode .sangeet-info .version {
    color: var(--secondary-color);
}
    </style>
    <style>
        #search-container {
    position: sticky;
    top: 0;
    z-index: 10;
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    padding: 10px;
    background-color: var(--background-color);
}

.search-input-wrapper {
    flex-grow: 1;
    margin-right: 10px;
}

.hamburger-menu {
    position: relative;
    margin-left: 10px;
}

.hamburger-icon {
    width: 24px;
    height: 18px;
    position: relative;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.hamburger-icon span {
    display: block;
    height: 2px;
    width: 100%;
    background-color: var(--text-color);
    transition: all 0.3s ease;
}

.hamburger-menu.active .hamburger-icon span:nth-child(1) {
    transform: translateY(8px) rotate(45deg);
}

.hamburger-menu.active .hamburger-icon span:nth-child(2) {
    opacity: 0;
}

.hamburger-menu.active .hamburger-icon span:nth-child(3) {
    transform: translateY(-8px) rotate(-45deg);
}

.menu-items {
    position: absolute;
    top: 100%;
    right: 0;
    background-color: var(--card-color);
    border-radius: 10px;
    padding: 10px;
    box-shadow: 0 2px 10px var(--shadow-color);
    display: none;
    flex-direction: column;
    gap: 10px;
    min-width: 150px;
}

.hamburger-menu.active .menu-items {
    display: flex;
}



.default-avatar {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 60px;
            color: #757575;
        }
.menu-items button {
    display: flex;
    align-items: center;
    gap: 10px;
    background: none;
    border: none;
    color: var(--text-color);
    cursor: pointer;
    padding: 10px;
    transition: background-color 0.3s;
    width: 100%;
    text-align: left;
}

.menu-items button:hover {
    background-color: var(--secondary-color);
    border-radius: 5px;
}

@media (max-width: 768px) {
    #search-container {
        flex-wrap: wrap;
    }

    .search-input-wrapper {
        width: 100%;
        margin-right: 0;
        margin-bottom: 10px;
    }

    .hamburger-menu {
        margin-left: auto;
    }
}
    </style>
    <style>
         .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            cursor: pointer;
        }

        .profile-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 68%;
            height: 68%;
            background-color: var(--card-color);
            border-radius: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .profile-panel.active {
            display: block;
        }
    </style>
</head>

<body>
    <div id="greeting-overlay">
        <div id="greeting-content">
            <div id="greeting-icon"></div>
            <div id="greeting-text"></div>
            <div id="greeting-subtext"></div>
            <div class="decoration circle"
                style="top: 10%; left: 10%; width: 50px; height: 50px; animation: float 4s infinite;"></div>
            <div class="decoration square"
                style="top: 20%; right: 15%; width: 30px; height: 30px; animation: spin 6s linear infinite;"></div>
            <div class="decoration circle"
                style="bottom: 15%; left: 20%; width: 40px; height: 40px; animation: float 5s infinite;"></div>
            <div class="decoration square"
                style="bottom: 10%; right: 10%; width: 20px; height: 20px; animation: spin 4s linear infinite;"></div>
            <div class="music-note" style="top: 5%; left: 5%;"></div>
            <div class="music-note" style="top: 80%; right: 5%;"></div>
            <div class="music-note" style="top: 40%; left: 80%;"></div>
        </div>
    </div>

    <div id="sticky-header">
        <div class="header-content">
            <div class="logo-container">
                <div class="logo">
                    <span class="logo-text">
                        <span class="header-beat-container"></span>
                        S<span class="musical-note"></span>ngeet
                    </span>
                </div>
                <span class="byline">Made by Sandesh</span>
            </div>
        </div>
    </div>
    <div id="app-container">
        <div id="search-container">
            {% if user['profile_pic'] %}
                <img src="{{ url_for('static', filename='profile_pics/' + user['profile_pic']) }}"
                    alt="Profile Picture" id="profile-pic"  class = "profile-pic" src = "/authentication/dashboard">
            {% else %}
                <img src="/pic" alt="Profile Picture" id="profile-pic"  class = "profile-pic" src = "/authentication/dashboard">
            {% endif %}
            <div class="search-input-wrapper">
                <input type="text" id="search-input" placeholder="Search for songs...">
                <button id="clear-search-btn" class="clear-search-btn">
                    <span class="material-icons">close</span>
                </button>
                <button id="search-btn" class="search-btn">
                    <span class="material-icons">search</span>
                </button>
            </div>
            <div id="search-suggestions"></div>
            <button id="theme-toggle">
                <span class="material-icons">brightness_4</span>
            </button>
            <button id="settings-button">
                <span class="material-icons">settings</span>
            </button>
            <div class="hamburger-menu">
                <div class="hamburger-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="menu-items">
                    <button id="filter-button">
                        <span class="material-icons">tune</span>
                        <span>Filter</span>
                    </button>
                    <button id="history-button">
                        <span class="material-icons">history</span>
                        <span>History</span>
                    </button>
                </div>
            </div>
        </div>
        <div id="songs-grid"></div>
        <div id="search-results-container" style="display: none;">
            <div id="youtube-results">
                <h2>Sangeet Universe!</h2>
                <div id="youtube-results-grid"></div>
            </div>
        </div>
        <div id="mini-player">
            <img id="mini-player-artwork" src="/static/default_artwork.jpg" alt="Current Song Artwork">
            <div id="mini-player-info">
                <div class="marquee-container">
                    <div class="marquee-content">
                        <span id="mini-player-title">Select a song</span>
                        <span id="mini-player-title-repeat">Select a song</span>
                    </div>
                </div>
                <div id="mini-player-artist"></div>
                <div id="mini-progress-container">
                    <div id="mini-progress-bar"></div>
                </div>
            </div>
            <button class="control-btn" id="mini-play-pause-btn">
                <span class="material-icons">play_arrow</span>
            </button>
        </div>
    </div>

    <div id="full-player">
        <button id="close-button">
            <span class="material-icons">close</span>
        </button>
        <div id="full-player-content">
            <img id="full-player-artwork" src="/static/default_artwork.jpg" alt="Current Song Artwork">
            <div class="marquee-container">
                <div class="marquee-content">
                    <span id="full-player-title">Select a song</span>
                    <span id="full-player-title-repeat">Select a song</span>
                </div>
            </div>
            <p id="full-player-artist"></p>
            <div id="full-progress-container">
                <div id="full-progress-bar"></div>
            </div>
            <div id="time-info">
                <span id="current-time">0:00</span>
                <span id="duration">0:00</span>
            </div>
            <br>
            <br>
            <div id="player-controls">
                <button class="control-btn" id="prev-btn">
                    <span class="material-icons">skip_previous</span>
                </button>
                <button class="control-btn" id="play-pause-btn">
                    <span class="material-icons">play_arrow</span>
                </button>
                <button class="control-btn" id="next-btn">
                    <span class="material-icons">skip_next</span>
                </button>
                <button class="control-btn" id="shuffle-btn">
                    <span class="material-icons">shuffle</span>
                </button>
                <a id="song-download" class="control-btn"></a>
                <button class="control-btn" id="show-mode-btn">
                    <span class="material-icons">music_note</span>
                </button>
                <button class="control-btn" id="embed-btn" title="Copy embed link">
                    <span class="material-icons">code</span>
                </button>
            </div>
            <div id="lyrics-container">
                <h3>Lyrics</h3>
                <div id="lyrics-content"></div>
                <h3 id="lyrics-source"></h3>
            </div>
            <div id="song-details">
                <h3>Song Details</h3>
                <p id="song-title"></p>
                <p id="song-artist"></p>
                <p id="song-album"></p>
                <p id="song-year"></p>
                <p id="song-genre"></p>
                <p id="song-bitrate"></p>
                <p id="song-sample-rate"></p>
                <p id="song-channels"></p>
                <p id="song-file-size"></p>
                <p id="song-duration"></p>
            </div>
            <div id="song-details">
                <h2 style="color:grey;font:bold;font-family:Arial, Helvetica, sans-serif;">Brought To You By Sangeet -
                    Made By Sandesh!</h2>
            </div>
            <div id="song-stats-content"></div>
        </div>
    </div>

    <div id="filter-panel">
        <button id="close-filter-panel">
            <span class="material-icons">close</span>
        </button>
        <div class="music-stats-container">
            <div class="music-stat" title="Total music files">
                <span class="music-stat-icon"></span>
                <span class="music-stat-info" id="total-files">0</span>
                <span class="music-stat-label">Files</span>
            </div>
            <div class="music-stat" title="Total disk space used">
                <span class="music-stat-icon">
                    <img src="/icons/hdd" alt="HDD">
                </span>
                <span class="music-stat-info" id="total-space">0 GB</span>
                <span class="music-stat-label">Space</span>
            </div>
        </div>
        <div class="filter-section">
            <h3><span class="material-icons">date_range</span> Year Range</h3>
            <div class="filter-section">
                <input type="range" id="year-slider" class="filter-slider" min="1900" max="2023" step="1" value="2023">
                <p id="year-display">1900 - 2023</p>
            </div>
            <!-- <p id="year-display">1900 - 2023</p> -->
        </div>
        <div class="filter-section">
            <h3><span class="material-icons">audiotrack</span> Genre</h3>
            <div id="genre-filters"></div>
        </div>
        <div class="filter-section">
            <h3><span class="material-icons">storage</span> File Size</h3>
            <div id="size-filters"></div>
        </div>
        <button id="apply-filters-btn">Apply Filters</button>
    </div>

    <div id="listening-history-panel">
        <button id="close-history-panel">
            <span class="material-icons">close</span>
        </button>
        <h2>Listening History</h2>
        <div id="history-list"></div>
        <button id="view-more-history">View More</button>
    </div>

    <div id="stats-panel" class="stats-panel">
        <div class="stats-content">
            <button id="close-stats-panel" class="close-button">&times;</button>
            <h2 id="stats-title" class="stats-title"></h2>
            <p id="stats-artist" class="stats-artist"></p>
            <div class="stats-grid">
                <div class="stats-card">
                    <i class="material-icons">headphones</i>
                    <span id="stats-total-listens"></span>
                    <p>Total Listens</p>
                </div>
                <div class="stats-card">
                    <i class="material-icons">access_time</i>
                    <span id="stats-total-time"></span>
                    <p>Total Time</p>
                </div>
                <div class="stats-card">
                    <i class="material-icons">update</i>
                    <span id="stats-last-listened"></span>
                    <p>Last Listened</p>
                </div>
                <div class="stats-card">
                    <i class="material-icons">play_arrow</i>
                    <span id="stats-last-position"></span>
                    <p>Last Position</p>
                </div>
            </div>
            <h3 class="history-title">Recent Listening History</h3>
            <ul id="stats-history-list" class="history-list"></ul>
            <canvas id="listening-trend-chart"></canvas>
        </div>
    </div>

    <div id="loading-indicator">
        <div class="spinner">
            <div class="dot dot-1"></div>
            <div class="dot dot-2"></div>
            <div class="dot dot-3"></div>
        </div>
        <p class="searching-text">Searching on Sangeet Universe</p>
    </div>

    <template id="youtube-result-template">
        <div class="song-card youtube-result">
            <img src="" alt="Thumbnail" class="youtube-thumbnail">
            <div class="song-info">
                <div class="song-title"></div>
                <div class="song-artist"></div>
            </div>
            <button class="play-now-btn youtube-result-action"></button>
        </div>
    </template>
    <div id="youtube-link-popup" class="hidden">
        <button id="close-popup" class="close-btn">&times;</button>
        <h2>YouTube Link Detected!</h2>
        <p id="popup-message"></p>
        <div class="popup-buttons">
            <button id="not-now-btn">Not Now</button>
            <button id="sure-btn">Sure!</button>
        </div>
    </div>
    <div id="show-mode-panel" class="hidden">
        <img id="show-mode-artwork" src="/static/default_artwork.jpg" alt="Current Song Artwork">
        <div id="show-mode-song-info">
            <div id="show-mode-title-container">
                <div id="show-mode-title">No song playing</div>
            </div>
            <div id="show-mode-artist">Unknown artist</div>
        </div>
        <button id="close-show-mode-btn" class="control-btn">
            <span class="material-icons">close</span>
        </button>
    </div>
    <div id="delete-confirmation-modal" class="modal">
        <div class="modal-content">
            <h2>Are you sure?</h2>
            <p id="delete-confirmation-message"></p>
            <div class="modal-buttons">
                <button id="cancel-delete" class="modal-button cancel">Keep it</button>
                <button id="confirm-delete" class="modal-button confirm">Yes, delete</button>
            </div>
        </div>
    </div>
    <div id="cautionPane" class="caution-pane">
        <div class="caution-content">
            <h2> Important Notice </h2>
            <p>Welcome to Sangeet! Before you begin, please read the following carefully:</p>
            <ul>
                <li>Sangeet is a personal music project and should not be used as a distributor for music or to charge
                    others for music.</li>
                <li>Please use Sangeet responsibly and respect all applicable copyright laws and regulations.</li>
                <li>Sangeet is not responsible for any legal actions or DRM violations resulting from misuse of this
                    project.</li>
                <li>Any money collected using music from this project is solely the responsibility of the user.</li>
                <li>By using Sangeet, you agree to use it for personal, non-commercial purposes only.</li>
            </ul>
            <p>Enjoy your music responsibly with Sangeet!</p>
            <div class="agreement-box">
                <input type="checkbox" id="agreementCheckbox">
                <label for="agreementCheckbox">I have read and agree to the terms of use</label>
            </div>
            <button id="understandButton" disabled>Continue to Sangeet</button>
        </div>
    </div>
    <div id="settings-panel" class="settings-panel">
        <div class="settings-content">
            <h2>Settings</h2>
            <div class="settings-section">
                <h3>Library Management</h3>
                <div class="setting-item">
                    <span>Clean Up Library</span>
                    <button id="cleanup-btn" class="settings-btn">Clean Up</button>
                </div>
                <div class="separator"></div>
                <div class="sangeet-info">
                    <h3>Sangeet One</h3>
                    <p class="version">Version: v13.0.0.1 Loving Soul LTS</p>
                </div>
                <div class="detailed-info">
                    <h4>Detailed Information</h4>
                    <p>Sangeet One is a powerful music player designed to enhance your listening experience. With advanced features and a user-friendly interface, it brings your music to life.</p>
                    <p>Version Inlcudes...</p>
                    <ul>
                        <li>High Quality Playback</li>
                        <li>High-quality audio processing</li>
                        <li>Smooth Layout</li>
                        <li>Lyrics integration</li>
                        <li>Upgraded Performance</li>
                        <li>Added Visual amplifier and harmonic exciter and a bass..</li>
                        <li>New sangeet song embed</li>
                        <li>This is a lts version so it will get long term updates</li>
                        <li>All Songs and content showed in this project is not a property or belongs to sangeet or its developer , its just a project made for self interest , usage of it for production or monetize or distribution is illegal and may come under copyright</li>
                    </ul>
                </div>
            </div>
            <button id="close-settings-btn" class="close-btn">&times;</button>
        </div>
    </div>

    <div id="cleanup-confirmation" class="modal">
        <div class="modal-content">
            <h2>Clean Up Library</h2>
            <p>Are you sure you want to clean up all library? This action cannot be undone.</p>
            <div class="modal-buttons">
                <button id="cleanup-no" class="modal-button cancel">No</button>
                <button id="cleanup-yes" class="modal-button confirm">Yes</button>
            </div>
        </div>
    </div>

    <div id="cleanup-spinner" class="modal">
        <div class="modal-content">
            <div class="cleanup-spinner"></div>
            <p id="cleanup-status">Cleaning up...</p>
        </div>
    </div>
    <footer style="background-color: black; padding: 20px 0; text-align: center;">
        <img src="/asset/watermark" alt="Centered Footer Image" style="max-width: 20%; height: 20; margin-bottom:4%;">
    </footer>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var profilePic = document.getElementById('profile-pic');
        
        profilePic.onerror = function() {
            this.src = '/pic';
        };
    });
    </script>
    <script>
          document.addEventListener('DOMContentLoaded', () => {
            // ... (existing event listeners) ...

            const profilePic = document.getElementById('profile-pic');

            profilePic.addEventListener('click', () => {
                window.open("/authentication/dashboard", "_blank");
            });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const hamburgerMenu = document.querySelector('.hamburger-menu');
    const hamburgerIcon = document.querySelector('.hamburger-icon');

    hamburgerIcon.addEventListener('click', () => {
        hamburgerMenu.classList.toggle('active');
    });

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
        if (!hamburgerMenu.contains(e.target) && hamburgerMenu.classList.contains('active')) {
            hamburgerMenu.classList.remove('active');
        }
    });

    // Prevent menu from closing when clicking inside
    hamburgerMenu.addEventListener('click', (e) => {
        e.stopPropagation();
    });

    // Add event listeners for menu items
    document.getElementById('filter-button').addEventListener('click', toggleFilterPanel);
    document.getElementById('history-button').addEventListener('click', toggleHistoryPanel);
});
    </script>
    <script>
        function toggleLyrics() {
            const lyricsContainer = document.getElementById('lyrics-container');
            lyricsContainer.style.display = lyricsContainer.style.display === 'none' ? 'block' : 'none';
        }

        function fetchAndDisplayLyrics(videoId) {
    const lyricsContainer = document.getElementById('lyrics-container');
    const lyricsContent = document.getElementById('lyrics-content');
    const lyricsSource = document.getElementById('lyrics-source');

    lyricsContent.textContent = 'Loading lyrics...';
    lyricsSource.textContent = '';
    lyricsContainer.style.display = 'block';

    fetch(`/lyrics/${videoId}`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                lyricsContent.textContent = data.lyrics;
                lyricsSource.textContent = `By ${data.source}`;
                lyricsContainer.style.display = 'block';
            } else {
                lyricsContainer.style.display = 'none';
            }
        })
        .catch(error => {
            console.error('Error fetching lyrics:', error);
            lyricsContainer.style.display = 'none';
        });
}

        // Add event listener for the toggle lyrics button
        document.getElementById('toggle-lyrics-btn').addEventListener('click', toggleLyrics);
    </script>
    <script>
        const NUM_HEADER_BARS = 40; // Increase the number of bars

        function createHeaderBeatBars() {
            const container = document.querySelector('.header-beat-container');
            container.innerHTML = '';
            headerBeatBars = [];

            for (let i = 0; i < NUM_HEADER_BARS; i++) {
                const bar = document.createElement('div');
                bar.className = 'header-beat-bar';
                container.appendChild(bar);
                headerBeatBars.push(bar);
            }
        }

        function updateHeaderBeatBars() {
            if (!audioContext || !analyser || !currentSong || !currentSong.playing()) return;

            analyser.getByteFrequencyData(dataArray);

            const barCount = headerBeatBars.length;
            const highestFrequency = 255;
            const barHeight = 20;

            for (let i = 0; i < barCount; i++) {
                const index = Math.floor(i * analyser.frequencyBinCount / barCount);
                const value = dataArray[index];
                const percent = value / highestFrequency;
                const height = percent * barHeight;
                headerBeatBars[i].style.height = `${height}px`;
                headerBeatBars[i].style.opacity = percent + 0.2;
            }

            requestAnimationFrame(updateHeaderBeatBars);
        }
    </script>
    <script>
        let showModePanel;
        let isShowModeActive = false;

        // Modify the toggleShowModePanel function
        function toggleShowModePanel() {
            showModePanel = document.getElementById('show-mode-panel');
            showModePanel.classList.toggle('hidden');
            isShowModeActive = !showModePanel.classList.contains('hidden');
            document.body.classList.toggle('show-mode-active', isShowModeActive);

            if (isShowModeActive) {
                updateShowModeInfo();
            }
        }

        // Add this function to update the show mode panel information
        function updateShowModeInfo() {
            const artwork = document.getElementById('show-mode-artwork');
            const title = document.getElementById('show-mode-title');
            const artist = document.getElementById('show-mode-artist');

            if (currentSong) {
                artwork.src = document.getElementById('full-player-artwork').src;
                title.textContent = document.getElementById('full-player-title').textContent;
                artist.textContent = document.getElementById('full-player-artist').textContent;
            } else {
                artwork.src = '/static/default_artwork.jpg';
                title.textContent = 'No song playing';
                artist.textContent = 'Unknown artist';
            }
        }
    </script>
    <script>
        function checkClipboardForYouTube() {
            if (navigator.clipboard) {
                navigator.clipboard.readText()
                    .then(text => {
                        if (isYouTubeUrl(text)) {
                            const processedLinks = JSON.parse(localStorage.getItem('processedYouTubeLinks') || '[]');
                            if (!processedLinks.includes(text)) {
                                showYouTubePopup(text);
                            }
                        }
                    })
                    .catch(err => console.error('Failed to read clipboard contents: ', err));
            }
        }

        function isYouTubeUrl(url) {
            // Regular expression to match YouTube video and shorts URLs
            const youtubeVideoRegex = /^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube\.com\/(?:watch\?v=|shorts\/)|youtu.be\/))([a-zA-Z0-9_-]{11})(\S+)?$/;
            return youtubeVideoRegex.test(url);
        }

        function showYouTubePopup(url) {
            const popup = document.getElementById('youtube-link-popup');
            const message = document.getElementById('popup-message');
            const randomPrompts = [
                "Ooh, I spotted a YouTube link in your clipboard! Wanna groove to that tune?",
                "Hey there, music maestro! I see you've got a YouTube link copied. Shall we give it a listen?",
                "YouTube link detected! Ready to add some new beats to your Sangeet playlist?",
                "Looks like you've got music on your mind! Want to play that YouTube track you just copied?",
                "I spy with my little eye... a YouTube link! Fancy a musical interlude?"
            ];
            const promptText = randomPrompts[Math.floor(Math.random() * randomPrompts.length)];

            message.textContent = promptText;
            popup.classList.remove('hidden');

            const closeBtn = document.getElementById('close-popup');
            const notNowBtn = document.getElementById('not-now-btn');
            const sureBtn = document.getElementById('sure-btn');

            const addToProcessedLinks = () => {
                const processedLinks = JSON.parse(localStorage.getItem('processedYouTubeLinks') || '[]');
                if (!processedLinks.includes(url)) {
                    processedLinks.push(url);
                    localStorage.setItem('processedYouTubeLinks', JSON.stringify(processedLinks));
                }
            };

            const closePopup = () => {
                popup.classList.add('hidden');
                addToProcessedLinks();
                closeBtn.removeEventListener('click', closePopup);
                notNowBtn.removeEventListener('click', closePopup);
                sureBtn.removeEventListener('click', handleSure);
            };

            const handleSure = () => {
                initiateYouTubePlayback(url);
                addToProcessedLinks();
                closePopup();
            };

            closeBtn.addEventListener('click', closePopup);
            notNowBtn.addEventListener('click', closePopup);
            sureBtn.addEventListener('click', handleSure);
        }
        function initiateYouTubePlayback(url) {
            fetch('/play_youtube', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: url }),
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        console.log('YouTube playback initiated');
                        loadSong(data.filename);
                        updateSongInfo(data.filename);
                    } else {
                        console.error('Failed to initiate YouTube playback:', data.message);
                    }
                })
                .catch(error => console.error('Error initiating YouTube playback:', error));
        }

        setInterval(checkClipboardForYouTube, 5000); // Check every 5 seconds

        function clearProcessedYouTubeLinks() {
            localStorage.removeItem('processedYouTubeLinks');
        }
        function closePopup() {
            const popup = document.getElementById('youtube-link-popup');
            popup.classList.add('hidden');

            // Remove event listeners if they exist
            const closeBtn = document.getElementById('close-popup');
            const notNowBtn = document.getElementById('not-now-btn');
            const sureBtn = document.getElementById('sure-btn');

            if (closeBtn) closeBtn.removeEventListener('click', closePopup);
            if (notNowBtn) notNowBtn.removeEventListener('click', closePopup);
            if (sureBtn) sureBtn.removeEventListener('click', handleSure);
        }

    </script>
    <script>
        function getGreeting() {
            const hour = new Date().getHours();
            let greeting, icon, theme, subtext;

            if (hour >= 5 && hour < 12) {
                greeting = "Good Morning, Melody Maker! ";
                icon = "";
                theme = "morning";
                subtext = "Rise and shine! Let's kickstart your day with some ear-candy tunes that'll make your breakfast jealous!";
            } else if (hour >= 12 && hour < 14) {
                greeting = "Good Noon, Rhythm Rockstar! ";
                icon = "";
                theme = "noon";
                subtext = "It's high time for high notes! How about a lunch break symphony to spice up your midday meal?";
            } else if (hour >= 14 && hour < 17) {
                greeting = "Good Afternoon, Harmony Hero! ";
                icon = "";
                theme = "afternoon";
                subtext = "Feeling that midday slump? Let's pump up the jam and turn your afternoon into a dance-tastic adventure!";
            } else if (hour >= 17 && hour < 21) {
                greeting = "Good Evening, Twilight Troubadour! ";
                icon = "";
                theme = "evening";
                subtext = "As the day winds down, let's wind up some mellow melodies to paint your evening with audible colors!";
            } else {
                greeting = "Good Night, Midnight Maestro! ";
                icon = "";
                theme = "night";
                subtext = "The stars are out, and so are your favorite nocturnal tunes! Time to orchestrate the perfect midnight playlist!";
            }

            return { greeting, icon, theme, subtext };
        }

        function showGreeting() {
            const { greeting, icon, theme, subtext } = getGreeting();
            const overlay = document.getElementById('greeting-overlay');
            const content = document.getElementById('greeting-content');
            const iconElement = document.getElementById('greeting-icon');
            const textElement = document.getElementById('greeting-text');
            const subtextElement = document.getElementById('greeting-subtext');

            content.className = theme;
            iconElement.textContent = icon;
            iconElement.style.animation = 'wave 2s infinite';
            textElement.textContent = greeting;
            subtextElement.textContent = subtext;

            // Remove the overlay after 6 seconds
            setTimeout(() => {
                overlay.remove();
            }, 6000);
        }

        document.addEventListener('DOMContentLoaded', showGreeting);
    </script>

    <script>
        const stars = document.querySelectorAll('.star');
        const submitButton = document.getElementById('submitRating');
        let selectedRating = 0;

        stars.forEach(star => {
            star.addEventListener('click', () => {
                selectedRating = parseInt(star.getAttribute('data-rating'));
                updateStars();
            });
        });

        function updateStars() {
            stars.forEach(star => {
                const rating = parseInt(star.getAttribute('data-rating'));
                if (rating <= selectedRating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        submitButton.addEventListener('click', () => {
            if (selectedRating > 0) {
                fetch('/rate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ rating: selectedRating }),
                })
                    .then(response => response.json())
                    .then(data => {
                        alert(`Thank you for rating Sangeet ${selectedRating} stars! ${data.message}`);
                    })
                    .catch((error) => {
                        console.error('Error:', error);

                    });
            } else {

            }
        });
    </script>
    <script>
        function updateMusicStats() {
            fetch('/music_stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('total-files').textContent = data.total_files;
                    const totalSpaceGB = (data.total_size / (1024 * 1024 * 1024)).toFixed(2);
                    document.getElementById('total-space').textContent = `${totalSpaceGB} GB`;
                })
                .catch(error => console.error('Error fetching music stats:', error));
        }

        function startContinuousUpdate() {
            updateMusicStats(); // Initial update
            setInterval(updateMusicStats, 5000); // Update every 5 seconds
        }
    </script>

    <script>
        // JavaScript code goes here
        let currentSong = null;
        let playlist = [];
        let currentIndex = 0;
        let allSongs = [];
        let filters = {
            year: [1900, 2023],
            genre: [],
            size: []
        };
        let listeningHistory = [];
        let listeningTrendChart;
    
        let dataArray;
        let beatBars;


        let beatContainer;


        function renderSongCards(songs) {
            const songsGrid = document.getElementById('songs-grid');
            songsGrid.innerHTML = '';

            songs.forEach(song => {
                const songCard = document.createElement('div');
                songCard.className = 'song-card';
                songCard.dataset.filename = song.filename;

                const artwork = document.createElement('img');
                artwork.src = song.thumbnail;
                artwork.onerror = function () {
                    this.src = '/static/default_artwork.jpg';
                };
                artwork.alt = `${song.title} Artwork`;

                const songInfo = document.createElement('div');
                songInfo.className = 'song-info';
                songInfo.innerHTML = `
                <div class="song-title">${song.title}</div>
                <div class="song-artist">${song.artist}</div>
            `;

                songCard.appendChild(artwork);
                songCard.appendChild(songInfo);
                songsGrid.appendChild(songCard);
            });
        }
        function updateHeaderPlayingState(isPlaying) {
            const logoContainer = document.querySelector('.logo-container');
            if (isPlaying) {
                logoContainer.classList.add('playing');
            } else {
                logoContainer.classList.remove('playing');
            }
        }

      
     
        function handleAudioError(error) {
            console.error('Audio playback error:', error);
            alert('There was an error playing the audio. Please try again or select a different song.');

            // Attempt to recover by resetting the audio context
            if (audioContext) {
                audioContext.close().then(() => {
                    audioContext = null;
                    initAudio();
                });
            }
        }

        function optimizedUpdate() {
            updateProgress();
            if (currentSong && currentSong.playing()) {
                // Throttle beat bar updates to roughly match screen refresh rate (e.g., 60fps)
                if (Date.now() - lastBeatUpdate > 16) {
                    updateBeatVisualization();
                    lastBeatUpdate = Date.now();
                }
            }
            requestAnimationFrame(optimizedUpdate);
        }

        // Call optimizedUpdate instead of separate update functions
        requestAnimationFrame(optimizedUpdate);
        function checkBrowserCompatibility() {
            if (!window.AudioContext && !window.webkitAudioContext) {
                alert('Your browser does not support the Web Audio API. Please use a modern browser for the best experience.');
                return false;
            }
            return true;
        }

        // Call this function when initializing your app
        if (!checkBrowserCompatibility()) {
            // Disable audio features or show a warning
        }

        // Call this instead of separate update functions
        requestAnimationFrame(optimizedUpdate);
        function updateAudioInfo() {
            const audioInfo = document.getElementById('audio-info');
            if (!audioInfo) return;

            if (!audioContext || !analyser) {
                audioInfo.innerHTML = '<p>Audio context not initialized</p>';
                return;
            }

            const sampleRate = audioContext.sampleRate;
            const fftSize = analyser.fftSize;
            const frequencyBinCount = analyser.frequencyBinCount;
            const minDecibels = analyser.minDecibels;
            const maxDecibels = analyser.maxDecibels;
            const smoothingTimeConstant = analyser.smoothingTimeConstant;

            let currentState = 'Unknown';
            if (currentSong) {
                currentState = currentSong.playing() ? 'Playing' : 'Paused';
            }

            let volumeLevel = 'Unknown';
            if (gainNode) {
                volumeLevel = Math.round(gainNode.gain.value * 100) + '%';
            }

            audioInfo.innerHTML = `
        <h3>Audio System Information</h3>
        <p>Audio Context State: ${audioContext.state}</p>
        <p>Sample Rate: ${sampleRate} Hz</p>
        <p>FFT Size: ${fftSize}</p>
        <p>Frequency Bin Count: ${frequencyBinCount}</p>
        <p>Analyser Range: ${minDecibels} dB to ${maxDecibels} dB</p>
        <p>Smoothing Time Constant: ${smoothingTimeConstant}</p>
        <p>Current Playback State: ${currentState}</p>
        <p>Volume Level: ${volumeLevel}</p>
    `;

            if (currentSong && currentSong._sounds && currentSong._sounds[0]) {
                const sound = currentSong._sounds[0];
                audioInfo.innerHTML += `
            <h3>Current Song Information</h3>
            <p>Duration: ${formatTime(currentSong.duration())}</p>
            <p>Current Time: ${formatTime(currentSong.seek())}</p>
            <p>Playback Rate: ${sound._rate}</p>
            <p>Is Sprite: ${sound._sprite ? 'Yes' : 'No'}</p>
            <p>Loop: ${sound._loop ? 'Yes' : 'No'}</p>
        `;
            }
        }

        function checkAndFetchYear(filename) {
            const yearElement = document.getElementById('song-year');
            if (yearElement && yearElement.textContent === 'Year: Unknown') {
                fetch(`/year/${filename}`)
                    .then(response => response.text())
                    .then(year => {
                        if (year && year !== 'Unknown') {
                            yearElement.textContent = `Year: ${year}`;
                            // Update the year in the song card as well
                            const songCard = document.querySelector(`.song-card[data-filename="${filename}"]`);
                            if (songCard) {
                                const cardYearElement = songCard.querySelector('.song-year');
                                if (cardYearElement) {
                                    cardYearElement.textContent = `Year: ${year}`;
                                }
                            }
                        }
                    })
                    .catch(error => console.error('Error fetching year:', error));
            }
        }
        // Add this function to create a single share button
        function createShareButton() {
            const shareButton = document.createElement('button');
            shareButton.className = 'share-button';
            shareButton.innerHTML = '<span class="material-icons">share</span>';
            shareButton.id = 'share-button';
            return shareButton;
        }

        function updateSongInfo(filename) {
    fetch(`/metadata/${filename}`)
        .then(response => response.json())
        .then(metadata => {
            // Update mini player
            updateMarqueeContent('mini-player-title', metadata.title || 'Unknown Title');
            document.getElementById('mini-player-artist').textContent = metadata.artist || 'Unknown Artist';

            const miniPlayerArtwork = document.getElementById('mini-player-artwork');
            miniPlayerArtwork.src = metadata.thumbnail;
            miniPlayerArtwork.onerror = function () {
                this.src = '/static/default_artwork.jpg';
            };

            // Update full player
            updateMarqueeContent('full-player-title', metadata.title || 'Unknown Title');
            document.getElementById('full-player-artist').textContent = metadata.artist || 'Unknown Artist';

            const fullPlayerArtwork = document.getElementById('full-player-artwork');
            fullPlayerArtwork.src = metadata.thumbnail;
            fullPlayerArtwork.onerror = function () {
                this.src = '/static/default_artwork.jpg';
            };

            // Update song details
            document.getElementById('song-title').textContent = `Title: ${metadata.title || 'Unknown'}`;
            document.getElementById('song-artist').textContent = `Artist: ${metadata.artist || 'Unknown'}`;
            document.getElementById('song-album').textContent = `Album: ${metadata.album || 'Unknown'}`;
            document.getElementById('song-year').textContent = `Year: ${metadata.year || 'Unknown'}`;
            document.getElementById('song-genre').textContent = `Genre: ${metadata.genre || 'Unknown'}`;
            document.getElementById('song-bitrate').textContent = `Bitrate: ${metadata.bitrate || 'Unknown'}`;
            document.getElementById('song-sample-rate').textContent = `Sample Rate: ${metadata.sample_rate || 'Unknown'}`;
            document.getElementById('song-channels').textContent = `Channels: ${metadata.channels || 'Unknown'}`;
            document.getElementById('song-file-size').textContent = `File Size: ${formatFileSize(metadata.file_size)}`;
            document.getElementById('song-duration').textContent = `Duration: ${formatTime(metadata.duration)}`;

            // Update download link
            const downloadLink = document.getElementById('song-download');
            downloadLink.href = metadata.download;
            downloadLink.innerHTML = '<i class="material-icons">file_download</i>';
            downloadLink.title = 'Download';
            downloadLink.setAttribute('download', '');

            // Update share button
            let shareButton = document.getElementById('share-button');
            if (!shareButton) {
                shareButton = createShareButton();
                downloadLink.parentNode.insertBefore(shareButton, downloadLink.nextSibling);
            }
            shareButton.onclick = function (e) {
                e.preventDefault();
                copyShareLink(metadata.share, filename);
            };

            // Update show mode info if active
            if (isShowModeActive) {
                updateShowModeInfo();
            }

            // Update song card if it exists
            const songCard = document.querySelector(`.song-card[data-filename="${filename}"]`);
            if (songCard) {
                let yearElement = songCard.querySelector('.song-year');
                if (!yearElement) {
                    yearElement = document.createElement('div');
                    yearElement.className = 'song-year';
                    songCard.querySelector('.song-info').appendChild(yearElement);
                }
                yearElement.textContent = `Year: ${metadata.year || 'Unknown'}`;
            }

            resetMarqueeAnimation();

            // Check and fetch the year if it's unknown
            if (metadata.year === 'Unknown' || !metadata.year) {
                checkAndFetchYear(filename);
            }

            // Fetch lyrics
            const videoId = filename.replace('.flac', '');
            fetchLyrics(videoId);
        })
        .catch(error => {
            console.error('Error fetching metadata:', error);
        });
}
function fetchLyrics(videoId) {
    const lyricsContainer = document.getElementById('lyrics-container');
    const lyricsContent = document.getElementById('lyrics-content');
    const lyricsSource = document.getElementById('lyrics-source');

    lyricsContent.textContent = 'Loading lyrics...';
    lyricsSource.textContent = '';
    lyricsContainer.style.display = 'block';

    fetch(`/lyrics/${videoId}`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                lyricsContent.textContent = data.lyrics;
                lyricsSource.textContent = `By ${data.source}`;
                lyricsContainer.style.display = 'block';
            } else {
                lyricsContainer.style.display = 'none';
            }
        })
        .catch(error => {
            console.error('Error fetching lyrics:', error);
            lyricsContainer.style.display = 'none';
        });
}
        function copyShareLink(shareUrl, filename) {
            const icon = document.querySelector('#share-button .material-icons');

            navigator.clipboard.writeText(shareUrl).then(() => {
                icon.textContent = 'check';
                setTimeout(() => {
                    icon.textContent = 'share';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }
        function initializeFilters(songs) {
            // Year filter
            const years = songs.map(song => song.year).filter(year => year);
            const minYear = Math.min(...years);
            const maxYear = Math.max(...years);

            const yearSlider = document.getElementById('year-slider');
            const yearDisplay = document.getElementById('year-display');

            yearSlider.min = minYear;
            yearSlider.max = maxYear;
            yearSlider.value = maxYear;

            yearDisplay.textContent = `${minYear} - ${maxYear}`;

            yearSlider.addEventListener('input', () => {
                const selectedMaxYear = parseInt(yearSlider.value);
                yearDisplay.textContent = `${minYear} - ${selectedMaxYear}`;
                filters.year = [minYear, selectedMaxYear];
            });

            // Genre filter
            const genres = [...new Set(songs.map(song => song.genre))].filter(genre => genre).sort();
            const genreFilters = document.getElementById('genre-filters');
            genreFilters.innerHTML = genres.map(genre => `
        <input type="checkbox" id="genre-${genre}" class="filter-checkbox" value="${genre}">
        <label for="genre-${genre}">${genre}</label>
    `).join('');

            // File size filter
            const fileSizes = songs.map(song => song.size);
            const minSize = Math.min(...fileSizes);
            const maxSize = Math.max(...fileSizes);

            const sizeRanges = [
                { name: 'Small', max: 10 * 1024 * 1024 },
                { name: 'Medium', max: 50 * 1024 * 1024 },
                { name: 'Large', max: 100 * 1024 * 1024 },
                { name: 'Very Large', max: Infinity }
            ];

            const sizeFilters = document.getElementById('size-filters');
            sizeFilters.innerHTML = sizeRanges
                .filter(range => range.max > minSize)
                .map(range => `
            <input type="checkbox" id="size-${range.name}" class="filter-checkbox" value="${range.name}">
            <label for="size-${range.name}">${range.name}</label>
        `).join('');

            // Event listeners for filters
            document.querySelectorAll('#genre-filters input, #size-filters input').forEach(input => {
                input.addEventListener('change', () => {
                    if (input.name === 'genre') {
                        filters.genre = Array.from(document.querySelectorAll('#genre-filters input:checked')).map(input => input.value);
                    } else if (input.name === 'size') {
                        filters.size = Array.from(document.querySelectorAll('#size-filters input:checked')).map(input => input.value);
                    }
                });
            });

            // Initialize filters object
            filters = {
                year: [minYear, maxYear],
                genre: [],
                size: []
            };
        }
        function applyFilters() {
    if (!audioContext || !currentSong) {
        console.error("Audio context or current song not available");
        return;
    }

    // Year filter
    const [minYear, maxYear] = filters.year;
    // Convert years to frequencies (this is a simplification and may need adjustment)
    const minFreq = yearToFrequency(minYear);
    const maxFreq = yearToFrequency(maxYear);

    // Apply year filter using lowpass and highpass filters
    lowpassFilter.frequency.setValueAtTime(maxFreq, audioContext.currentTime);
    highpassFilter.frequency.setValueAtTime(minFreq, audioContext.currentTime);

    // Genre filter
    if (filters.genre.length > 0) {
        // This is a placeholder. In reality, genre filtering would require 
        // more complex audio analysis or pre-analyzed metadata.
        console.log("Genre filter applied:", filters.genre);
        // You might adjust certain audio parameters based on genre
        // For example, boosting bass for certain genres:
        if (filters.genre.includes('Bass-heavy')) {
            const bassBoost = audioContext.createBiquadFilter();
            bassBoost.type = 'lowshelf';
            bassBoost.frequency.setValueAtTime(200, audioContext.currentTime);
            bassBoost.gain.setValueAtTime(10, audioContext.currentTime);
            // Insert bassBoost into the audio chain
            disconnectAndReconnectNodes(gainNode, lowpassFilter, bassBoost);
        }
    }

    // Size filter
    if (filters.size.length > 0) {
        // Size filtering doesn't directly affect audio processing
        // But we can use it to adjust buffer size or streaming behavior
        const maxSize = Math.max(...filters.size.map(sizeToBytes));
        adjustBufferSize(maxSize);
    }

    // Apply any additional audio effects or processing here
    // For example, you might have an equalizer or dynamic compression

    console.log("Filters applied:", filters);
}

        function toggleFilterPanel() {
            document.getElementById('filter-panel').classList.toggle('active');
        }

        function toggleHistoryPanel() {
            document.getElementById('listening-history-panel').classList.toggle('active');
        }


        function deleteSong(filename, title) {
            const modal = document.getElementById('delete-confirmation-modal');
            const message = document.getElementById('delete-confirmation-message');
            const confirmButton = document.getElementById('confirm-delete');
            const cancelButton = document.getElementById('cancel-delete');

            message.textContent = `Do you want to remove "${title}" from your Sangeet collection?`;

            modal.style.display = 'block';

            confirmButton.onclick = function () {
                modal.style.display = 'none';
                performDelete(filename);
            }

            cancelButton.onclick = function () {
                modal.style.display = 'none';
            }

            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }
        }

        function performDelete(filename) {
            fetch('/delete_song', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ filename: filename }),
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Song deleted:', data);
                    // Remove the song from the listening history
                    listeningHistory = listeningHistory.filter(item => item.filename !== filename);
                    // Re-render the listening history
                    renderListeningHistory();
                    // Remove the song from the playlist if it exists
                    const index = playlist.indexOf(filename);
                    if (index > -1) {
                        playlist.splice(index, 1);
                    }
                    // If the deleted song was currently playing, stop it and move to the next song
                    if (currentSong && currentSong._src === `/stream/${filename}`) {
                        currentSong.stop();
                        playNext();
                    }
                    // Refresh the main song grid
                    loadPlaylist();
                })
                .catch((error) => {
                    console.error('Error deleting song:', error);
                    alert('Error deleting song. Please try again.');
                });
        }

      
        let audioContext;
let sourceNode;

let analyser;
let currentBuffer;
let startTime;
let pausedAt = 0;
let isPlaying = false;
let currentSongFilename;

// Initialize audio context on user interaction
document.addEventListener('click', initAudio, { once: true });

function initAudio() {
    if (audioContext) return;

    try {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        gainNode = audioContext.createGain();
        analyser = audioContext.createAnalyser();
        gainNode.connect(analyser);
        analyser.connect(audioContext.destination);
        
        // Set up analyser
        analyser.fftSize = 256;
        const bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
        
        // Create beat visualization
        createBeatVisualization();
        
        console.log('Audio context initialized successfully');
    } catch (error) {
        console.error("Web Audio API is not supported in this browser", error);
        alert("Your browser doesn't support the required audio features. Please use a modern browser for the best experience.");
    }
}

function createBeatVisualization() {
    const beatContainer = document.createElement('div');
    beatContainer.className = 'beat-container';
    document.body.appendChild(beatContainer);

    const barCount = Math.min(analyser.frequencyBinCount, 80);
    beatBars = [];

    for (let i = 0; i < barCount; i++) {
        const bar = document.createElement('div');
        bar.className = 'beat-bar';
        bar.style.left = `${(i / barCount) * 100}%`;
        beatContainer.appendChild(bar);
        beatBars.push(bar);
    }
}
let showBeatVisualization = false;

function pauseSong() {
    if (!isPlaying) return;

    sourceNode.stop();
    pausedAt = audioContext.currentTime - startTime;
    isPlaying = false;
    showBeatVisualization = false;
    updatePlayButton();
    hideBeatBars();
}

function playSong() {
    if (!audioContext || !currentBuffer) return;

    sourceNode = audioContext.createBufferSource();
    sourceNode.buffer = currentBuffer;
    sourceNode.connect(gainNode);

    startTime = audioContext.currentTime - pausedAt;
    sourceNode.start(0, pausedAt);
    isPlaying = true;
    showBeatVisualization = true;

    sourceNode.onended = () => {
        if (isPlaying) {
            playNext();
        }
    };

    updatePlayButton();
    updateProgress();
    showBeatBars();
    updateBeatVisualization();
}

function updateBeatVisualization() {
    if (!analyser || !isPlaying || !showBeatVisualization) return;

    analyser.getByteFrequencyData(dataArray);

    for (let i = 0; i < beatBars.length; i++) {
        const value = dataArray[i];
        const percent = value / 255;
        const height = percent * 100;
        beatBars[i].style.height = `${height}vh`;
    }

    requestAnimationFrame(updateBeatVisualization);
}

function hideBeatBars() {
    beatBars.forEach(bar => {
        bar.classList.add('hidden');
    });
}

function showBeatBars() {
    beatBars.forEach(bar => {
        bar.classList.remove('hidden');
    });
}

// Ensure smooth transition when switching between play and pause rapidly
function togglePlayPause() {
    if (isPlaying) {
        pauseSong();
    } else {
        playSong();
    }
    updateHeaderPlayingState(isPlaying);
}
function loadSong(filename) {
    if (!audioContext) {
        console.error("Audio context not initialized");
        return;
    }

    // Stop current song if playing
    if (sourceNode) {
        sourceNode.stop();
        sourceNode.disconnect();
    }

    currentSongFilename = filename;
    pausedAt = 0;
    isPlaying = false;

    fetch(`/stream/${filename}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('HTTP error, status = ' + response.status);
            }
            return response.arrayBuffer();
        })
        .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
        .then(audioBuffer => {
            currentBuffer = audioBuffer;
            playSong();
            updateSongInfo(filename);
            if (isShowModeActive) updateShowModeInfo();
        })
        .catch(error => console.error('Error loading audio:', error));
}



function togglePlayPause() {
    if (isPlaying) {
        pauseSong();
    } else {
        playSong();
    }
    updateHeaderPlayingState(isPlaying);
}

function updatePlayButton() {
    const miniPlayPauseBtn = document.querySelector('#mini-play-pause-btn .material-icons');
    const fullPlayPauseBtn = document.querySelector('#play-pause-btn .material-icons');

    if (miniPlayPauseBtn) miniPlayPauseBtn.textContent = isPlaying ? 'pause' : 'play_arrow';
    if (fullPlayPauseBtn) fullPlayPauseBtn.textContent = isPlaying ? 'pause' : 'play_arrow';
}

// Define the missing function
function closeStatsPanelFunction() {
    const statsPanel = document.getElementById('stats-panel');
    if (statsPanel) {
        statsPanel.style.display = 'none';
    }
}




function toggleSettingsPanel() {
    const settingsPanel = document.getElementById('settings-panel');
    if (settingsPanel) {
        settingsPanel.classList.toggle('active');
    }
}

// ... (keep all other existing functions)
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
            else if (bytes < 1073741824) return (bytes / 1048576).toFixed(2) + ' MB';
            else return (bytes / 1073741824).toFixed(2) + ' GB';
        }

     
        document.addEventListener('DOMContentLoaded', createHeaderBeatBars);


        function updateShuffleButton(shuffled) {
            const shuffleBtn = document.getElementById('shuffle-btn');
            const icon = shuffleBtn.querySelector('.material-icons');

            if (shuffled) {
                icon.textContent = 'check';
                setTimeout(() => {
                    icon.textContent = 'shuffle';
                }, 5000);
            } else {
                icon.textContent = 'shuffle';
            }
        }
        function updateHeaderPlayingState(isPlaying) {
            const logoContainer = document.querySelector('.logo-container');
            if (isPlaying) {
                logoContainer.classList.add('playing');
            } else {
                logoContainer.classList.remove('playing');
            }
        }
        function updateShuffleButton(shuffled) {
            const shuffleBtn = document.getElementById('shuffle-btn');
            const icon = shuffleBtn.querySelector('.material-icons');

            if (shuffled) {
                icon.textContent = 'check';
                setTimeout(() => {
                    icon.textContent = 'shuffle';
                }, 5000);
            } else {
                icon.textContent = 'shuffle';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // ... (other initializations)

            const shuffleBtn = document.getElementById('shuffle-btn');
            shuffleBtn.addEventListener('click', () => {
                shufflePlaylist();
            });
        });

        // Modify the existing loadPlaylist function
        // Modify the existing loadPlaylist function
        function loadPlaylist() {
            fetch('/all_songs')
                .then(response => response.json())
                .then(songs => {
                    allSongs = songs;
                    playlist = songs.map(song => song.filename);
                    shufflePlaylist(); // Shuffle the playlist initially
                    renderSongCards(songs);
                    initializeFilters(songs);
                })
                .catch(error => {
                    console.error('Error fetching songs:', error);
                });
        }

        // Modify the shufflePlaylist function
        function shufflePlaylist() {
            const currentSongFilename = currentSong ? currentSong._src.split('/').pop() : null;
            let newPlaylist = [...playlist];

            for (let i = newPlaylist.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newPlaylist[i], newPlaylist[j]] = [newPlaylist[j], newPlaylist[i]];
            }

            // If there's a current song, make sure it's not the first in the new playlist
            if (currentSongFilename && newPlaylist[0] === currentSongFilename) {
                const indexOfCurrent = newPlaylist.findIndex(filename => filename === currentSongFilename);
                [newPlaylist[0], newPlaylist[indexOfCurrent]] = [newPlaylist[indexOfCurrent], newPlaylist[0]];
            }

            playlist = newPlaylist;
            currentIndex = currentSongFilename ? playlist.indexOf(currentSongFilename) : 0;
            updateShuffleButton(true);
            console.log('Playlist shuffled');
        }

        // Modify the playNext function
        function playNext() {
            shufflePlaylist(); // Shuffle the playlist before playing the next song
            currentIndex = (currentIndex + 1) % playlist.length;
            loadSong(playlist[currentIndex]);
            if (isShowModeActive) updateShowModeInfo();
        }

        // Modify the playPrevious function
        function playPrevious() {
            shufflePlaylist(); // Shuffle the playlist before playing the previous song
            currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
            loadSong(playlist[currentIndex]);
        }

        // Modify the existing playNext and playPrevious functions


        function updateActiveSong(filename) {
            document.querySelectorAll('.song-card').forEach(card => {
                card.classList.toggle('active', card.dataset.filename === filename);
            });
        }

        function toggleFullPlayer() {
            document.getElementById('full-player').classList.toggle('active');
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const themeToggle = document.getElementById('theme-toggle').querySelector('.material-icons');

            if (document.body.classList.contains('dark-mode')) {
                themeToggle.textContent = 'brightness_7';
                localStorage.setItem('theme', 'dark');
            } else {
                themeToggle.textContent = 'brightness_4';
                localStorage.setItem('theme', 'light');
            }

            if (listeningTrendChart) {
                updateChartTheme();
            }
        }

        function updateMarqueeContent(elementId, text) {
            const element = document.getElementById(elementId);
            const repeatElement = document.getElementById(elementId + '-repeat');
            element.textContent = text;
            repeatElement.textContent = text;
        }

        function resetMarqueeAnimation() {
            const marqueeContents = document.querySelectorAll('.marquee-content');
            marqueeContents.forEach(content => {
                content.style.animation = 'none';
                content.offsetHeight;
                content.style.animation = null;
            });
        }

        function updateListeningHistory(position, filename) {
            if (currentSong && filename) {
                fetch('/update_history', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        filename: filename,
                        position: position,
                    }),
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('History updated:', data);
                        loadListeningHistory();
                    })
                    .catch((error) => console.error('Error updating history:', error));
            }
        }

        function loadListeningHistory() {
            fetch('/listening_history')
                .then(response => response.json())
                .then(history => {
                    listeningHistory = history;
                    renderListeningHistory();
                })
                .catch((error) => console.error('Error:', error));
        }

        let displayedHistoryItems = 10;

        function renderListeningHistory() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = listeningHistory.slice(0, displayedHistoryItems).map(item => {
                const isCurrentlyPlaying = currentSong && currentSong._src === `/stream/${item.filename}`;
                return `
        <div class="history-item">
            <img src="/artwork2/${item.filename}" alt="${item.title} Artwork">
            <div class="history-info">
                <div class="history-title">${item.title}</div>
                <div class="history-artist">${item.artist}</div>
                <div class="history-actions">
                    <a class="history-stats-link" onclick="showStatsPanel('${item.filename}')">View Stats</a>
                    <a class="history-play-link" onclick="playFromHistory(this, '${item.filename}')">
                        <span class="play-icon material-icons">play_arrow</span>
                        <span class="spinner"></span>
                        <span class="error-icon material-icons">error</span>
                    </a>
                    ${!isCurrentlyPlaying ? `
                    <a class="history-delete-link" onclick="deleteSong('${item.filename}', '${item.title.replace("'", "\\'")}')">
                        <span class="delete-icon material-icons">delete</span>
                    </a>
                    ` : ''}
                </div>
            </div>
        </div>
    `;
            }).join('');

            const viewMoreButton = document.getElementById('view-more-history');
            if (displayedHistoryItems >= listeningHistory.length) {
                viewMoreButton.style.display = 'none';
            } else {
                viewMoreButton.style.display = 'block';
            }
        }

        function viewMoreHistory() {
            displayedHistoryItems += 10;
            renderListeningHistory();
        }

        function playFromHistory(element, filename) {
            const playLink = element;
            const playIcon = playLink.querySelector('.play-icon');
            const spinner = playLink.querySelector('.spinner');
            const errorIcon = playLink.querySelector('.error-icon');

            // Hide play icon, show spinner
            playIcon.style.display = 'none';
            spinner.style.display = 'inline-block';
            errorIcon.style.display = 'none';

            const filenameWithoutExt = filename.replace('.flac', '');
            fetch(`/sangeet/playback/history/"${encodeURIComponent(filenameWithoutExt)}"`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Server error');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Response from playback:', data);
                    // Hide spinner, show play icon
                    spinner.style.display = 'none';
                    playIcon.style.display = 'inline-block';
                    // You can add additional logic here if needed
                    // For example, updating the current playing song in the UI
                })
                .catch(error => {
                    console.error('Error playing from history:', error);
                    // Hide spinner, show error icon
                    spinner.style.display = 'none';
                    errorIcon.style.display = 'inline-block';
                    // Optionally, you can set a timeout to revert to the play icon after a few seconds
                    setTimeout(() => {
                        errorIcon.style.display = 'none';
                        playIcon.style.display = 'inline-block';
                    }, 3000);
                });
        }

        function showStatsPanel(filename) {
            fetch(`/song_stats/${filename}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById('stats-title').textContent = data.title;
                    document.getElementById('stats-artist').textContent = data.artist;
                    document.getElementById('stats-total-listens').textContent = data.total_listens;
                    document.getElementById('stats-total-time').textContent = formatTime(data.total_time);
                    document.getElementById('stats-last-listened').textContent = new Date(data.last_listened).toLocaleDateString();
                    document.getElementById('stats-last-position').textContent = formatTime(data.last_position);

                    const historyList = document.getElementById('stats-history-list');
                    historyList.innerHTML = data.history.map(item => `
                        <li>
                            <span>${new Date(item.timestamp).toLocaleString()}</span>
                            <span>${formatTime(item.position)}</span>
                        </li>
                    `).join('');

                    document.getElementById('stats-panel').style.display = 'block';
                    updateListeningTrendChart(data.history);
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alert('Error loading stats. Please try again.');
                });
        }

       

        function updateListeningTrendChart(history) {
            const ctx = document.getElementById('listening-trend-chart').getContext('2d');

            if (listeningTrendChart) {
                listeningTrendChart.destroy();
            }

            const chartData = processChartData(history);

            listeningTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: 'Listening Time',
                        data: chartData.data,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Listening Time (minutes)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        }
                    }
                }
            });

            updateChartTheme();
        }

        function processChartData(history) {
            const data = {};
            history.forEach(item => {
                const date = new Date(item.timestamp).toLocaleDateString();
                data[date] = (data[date] || 0) + item.position / 60; // Convert to minutes
            });

            return {
                labels: Object.keys(data),
                data: Object.values(data)
            };
        }

        function updateChartTheme() {
            const textColor = document.body.classList.contains('dark-mode') ? '#E0E0E0' : '#2C3E50';
            listeningTrendChart.options.scales.x.ticks.color = textColor;
            listeningTrendChart.options.scales.y.ticks.color = textColor;
            listeningTrendChart.options.plugins.legend.labels.color = textColor;
            listeningTrendChart.update();
        }

    


        let gainNode;



        // Call this function on the first user interaction
        document.addEventListener('click', initAudio, { once: true });
        // Update the initAudio function
        function updateHeaderBeatBars() {
            if (!audioContext || !analyser || !currentSong || !currentSong.playing()) return;

            analyser.getByteFrequencyData(dataArray);

            const containerHeight = document.querySelector('.logo-container').offsetHeight;
            const maxBarHeight = containerHeight * 0.8;

            for (let i = 0; i < NUM_HEADER_BARS; i++) {
                const index = Math.floor(i * analyser.frequencyBinCount / NUM_HEADER_BARS);
                const value = dataArray[index];
                const percent = value / 255;
                const height = percent * maxBarHeight;
                headerBeatBars[i].style.height = `${height}px`;
            }

            requestAnimationFrame(updateHeaderBeatBars);
        }
      
function disablePlaybackControls() {
    // Disable all playback-related buttons and show a message to the user
    const playbackControls = document.querySelectorAll('.control-btn');
    playbackControls.forEach(control => control.disabled = true);
    alert("Your browser doesn't support the required audio features for Sangeet. Please use a modern browser for the best experience.");
}

        // Update the connectAudioSource function
        function connectAudioSource() {
            if (!audioContext) return;

            if (currentSong && currentSong._sounds && currentSong._sounds[0] && currentSong._sounds[0]._node) {
                const source = audioContext.createMediaElementSource(currentSong._sounds[0]._node);
                source.connect(gainNode);
                gainNode.connect(analyser);
                analyser.connect(audioContext.destination);

                updateHeaderBeatBars();
            } else {
                console.error('Unable to connect audio source: currentSong or its properties are undefined');
            }
        }
        // Add this function to adjust the volume
        function adjustVolume() {
            if (gainNode) {
                // Get the device's volume (ranges from 0 to 1)
                const deviceVolume = audioContext.destination.volume.value;

                // Set the gain value based on the device's volume
                gainNode.gain.value = deviceVolume;
            }
        }

        // Call the adjustVolume function whenever the device's volume changes
        window.addEventListener('volumechange', adjustVolume);




        let searchTimeout;

        let searchSuggestions = [];




        let suggestionsTimeout;


        function debounceSearch() {
            clearTimeout(suggestionsTimeout);
            const searchTerm = document.getElementById('search-input').value.trim();

            if (searchTerm.length > 0) {
                suggestionsTimeout = setTimeout(() => {
                    fetchSearchSuggestions(searchTerm);
                }, 100);
            } else {
                clearSearchSuggestions();
                toggleHomeAndYouTubeResults(true);
            }
        }
        function hideYouTubeResults() {
            toggleHomeAndYouTubeResults(true);
        }
        function performSearch() {
            const searchTerm = document.getElementById('search-input').value.trim();
            if (searchTerm.length > 0) {
                searchYouTube(searchTerm);
                saveSearchQuery(searchTerm);
                clearSearchSuggestions();
            }
        }
        function fetchSearchSuggestions(query) {
            fetch(`/search_suggestions?query=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(suggestions => {
                    searchSuggestions = suggestions;
                    displaySearchSuggestions();
                })
                .catch(error => console.error('Error fetching search suggestions:', error));
        }

        function displaySearchSuggestions() {
            const suggestionsContainer = document.getElementById('search-suggestions');
            suggestionsContainer.innerHTML = '';

            searchSuggestions.forEach(suggestion => {
                const suggestionElement = document.createElement('div');
                suggestionElement.className = 'search-suggestion';
                suggestionElement.textContent = suggestion;
                suggestionElement.addEventListener('click', () => {
                    document.getElementById('search-input').value = suggestion;
                    searchYouTube(suggestion);
                    clearSearchSuggestions();
                });
                suggestionsContainer.appendChild(suggestionElement);
            });

            suggestionsContainer.style.display = searchSuggestions.length > 0 ? 'block' : 'none';
        }

        function clearSearchSuggestions() {
            const suggestionsContainer = document.getElementById('search-suggestions');
            suggestionsContainer.innerHTML = '';
            suggestionsContainer.style.display = 'none';
        }

        function saveSearchQuery(query) {
            fetch('/save_search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query: query }),
            })
                .catch(error => console.error('Error saving search query:', error));
        }

        // Update the event listener for the search input
        document.getElementById('search-input').addEventListener('input', debounceSearch);

        // Add this event listener to handle clicks outside the search suggestions
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#search-container')) {
                clearSearchSuggestions();
            }
        });

        function searchYouTube(searchTerm) {
            showLoadingIndicator();
            fetch('/search_youtube', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ search_term: searchTerm }),
            })
                .then(response => response.json())
                .then(results => {
                    renderYouTubeResults(results);
                    hideLoadingIndicator();
                    toggleHomeAndYouTubeResults(false);
                })
                .catch(error => {
                    console.error('Error searching Sangeet universe!', error);
                    hideLoadingIndicator();
                });
        }
        function renderYouTubeResults(results) {
            const resultsGrid = document.getElementById('youtube-results-grid');
            resultsGrid.innerHTML = '';

            if (results.length === 0) {
                const noResultsMessage = document.createElement('p');
                noResultsMessage.className = 'no-results-message';
                noResultsMessage.textContent = 'Sorry, we couldn\'t find anything for that search. Try adding more information to your query.';
                resultsGrid.appendChild(noResultsMessage);
                return;
            }

            const template = document.getElementById('youtube-result-template');

            results.forEach(result => {
                const songCard = template.content.cloneNode(true).querySelector('.song-card');
                songCard.querySelector('.youtube-thumbnail').src = result.thumbnail;
                songCard.querySelector('.song-title').textContent = result.title;
                songCard.querySelector('.song-artist').textContent = result.author;
                const actionButton = songCard.querySelector('.youtube-result-action');
                actionButton.textContent = result.file_exists ? 'Play Now' : 'Add to Library';
                actionButton.classList.toggle('song-exists', result.file_exists);
                actionButton.addEventListener('click', () => handleYouTubeAction(result.id, actionButton));
                resultsGrid.appendChild(songCard);
            });

            console.log('Rendered YouTube results:', results.length);
        }

        function handleYouTubeAction(videoId, button) {
            const filename = `${videoId}.flac`;
            if (button.classList.contains('song-exists')) {
                loadSong(filename);
            } else {
                downloadYouTubeAudio(videoId, button, filename);
            }
        }

        function downloadYouTubeAudio(videoId, button, filename) {
            button.textContent = 'Adding To Sangeet';
            button.classList.add('adding-to-sangeet');
            button.disabled = true;

            fetch('/download_youtube', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ video_id: videoId }),
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'completed') {
                        button.textContent = 'Play Now';
                        button.classList.remove('adding-to-sangeet');
                        button.disabled = false;
                        button.classList.add('song-exists');
                        loadPlaylist();
                        loadSong(filename);
                    } else {
                        throw new Error('Download failed');
                    }
                })
                .catch(error => {
                    console.error('Error downloading:', error);
                    button.textContent = 'Error';
                    button.classList.remove('adding-to-sangeet');
                    button.disabled = false;
                    setTimeout(() => {
                        button.textContent = 'Add to Library';
                    }, 3000);
                });
        }
        function startCustomCheck() {
            function checkCustom() {
                fetch('/checkcustom')
                    .then(response => response.text())
                    .then(data => {
                        if (data === "check") {
                            fetch('/share')
                                .then(response => response.json())
                                .then(metadata => {
                                    // Load and play the shared song
                                    loadSong(metadata.filename);

                                    // Update the UI with the new song information
                                    updateSongInfo(metadata.filename);

                                    // You might want to update other parts of the UI here
                                    // For example, updating the playlist or current song display
                                })
                                .catch(error => console.error('Error fetching shared song:', error));
                        }
                    })
                    .catch(error => console.error('Error checking custom:', error))
                    .finally(() => {
                        // Schedule the next check in 2 seconds
                        setTimeout(checkCustom, 2000);
                    });
            }

            // Start the initial check
            checkCustom();
        }
        function toggleHomeAndYouTubeResults(showHome) {
            document.getElementById('songs-grid').style.display = showHome ? 'grid' : 'none';
            document.getElementById('search-results-container').style.display = showHome ? 'none' : 'block';
        }
       

function updateProgress() {
    if (!currentBuffer) return;

    const currentTime = isPlaying ? audioContext.currentTime - startTime + pausedAt : pausedAt;
    const duration = currentBuffer.duration;
    const progress = (currentTime / duration) * 100;

    const miniProgressBar = document.getElementById('mini-progress-bar');
    const fullProgressBar = document.getElementById('full-progress-bar');
    const currentTimeSpan = document.getElementById('current-time');
    const durationSpan = document.getElementById('duration');

    if (miniProgressBar) miniProgressBar.style.width = `${progress}%`;
    if (fullProgressBar) fullProgressBar.style.width = `${progress}%`;
    if (currentTimeSpan) currentTimeSpan.textContent = formatTime(currentTime);
    if (durationSpan) durationSpan.textContent = formatTime(duration);

    if (isPlaying) {
        requestAnimationFrame(updateProgress);
    }
}


        function setCookie(name, value, days) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = name + '=' + value + ';expires=' + expires.toUTCString() + ';path=/';
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const cautionPane = document.getElementById('cautionPane');
            const agreementCheckbox = document.getElementById('agreementCheckbox');
            const understandButton = document.getElementById('understandButton');

            // Function to disable all controls except the checkbox and understand button
            function disableControls(disabled) {
                const controls = document.querySelectorAll('button, input, a');
                controls.forEach(control => {
                    if (control !== agreementCheckbox && control !== understandButton) {
                        control.disabled = disabled;
                        if (disabled) {
                            control.style.pointerEvents = 'none';
                        } else {
                            control.style.pointerEvents = '';
                        }
                    }
                });
            }

            // Check if the user has already agreed
            const hasAgreed = getCookie('sangeetAgreed');

            if (!hasAgreed) {
                // Show the caution pane if the user hasn't agreed before
                cautionPane.style.display = 'flex';
                disableControls(true);

                // Enable/disable the continue button based on checkbox state
                agreementCheckbox.addEventListener('change', () => {
                    understandButton.disabled = !agreementCheckbox.checked;
                });

                // Hide the caution pane, enable controls, and set cookie when the user agrees and clicks "Continue to Sangeet"
                understandButton.addEventListener('click', () => {
                    if (agreementCheckbox.checked) {
                        cautionPane.style.display = 'none';
                        disableControls(false);
                        setCookie('sangeetAgreed', 'true', 365); // Set cookie to expire after 1 year
                    }
                });
            } else {
                // If the user has already agreed, don't show the caution pane and enable all controls
                cautionPane.style.display = 'none';
                disableControls(false);
            }
        });

        function showLoadingIndicator() {
            document.getElementById('loading-indicator').style.display = 'block';
        }

        function hideLoadingIndicator() {
            document.getElementById('loading-indicator').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', () => {
    // Initialize audio system
    initAudio();

    // Load initial playlist
    loadPlaylist();

    // Load listening history
    loadListeningHistory();

    // Start continuous updates for music stats
    startContinuousUpdate();
   
    // Initialize UI components
    const searchInput = document.getElementById('search-input');
    const searchBtn = document.getElementById('search-btn');
    const clearSearchBtn = document.getElementById('clear-search-btn');
    const miniProgressContainer = document.getElementById('mini-progress-container');
    const fullProgressContainer = document.getElementById('full-progress-container');
    const miniPlayPauseBtn = document.getElementById('mini-play-pause-btn');
    const fullPlayPauseBtn = document.getElementById('play-pause-btn');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const shuffleBtn = document.getElementById('shuffle-btn');
    const themeToggleBtn = document.getElementById('theme-toggle');
    const filterBtn = document.getElementById('filter-button');
    const closeFilterBtn = document.getElementById('close-filter-panel');
    const historyBtn = document.getElementById('history-button');
    const closeHistoryBtn = document.getElementById('close-history-panel');
    const fullPlayerCloseBtn = document.getElementById('close-button');
    const showModeBtn = document.getElementById('show-mode-btn');
    const closeShowModeBtn = document.getElementById('close-show-mode-btn');
    const songsGrid = document.getElementById('songs-grid');
    const embedBtn = document.getElementById('embed-btn');
    const settingsButton = document.getElementById('settings-button');
    const closeSettingsBtn = document.getElementById('close-settings-btn');
    const viewMoreHistoryBtn = document.getElementById('view-more-history');

    // Search functionality
    if (searchInput) {
        searchInput.addEventListener('input', () => {
            if (clearSearchBtn) clearSearchBtn.style.display = searchInput.value ? 'block' : 'none';
            debounceSearch();
        });

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
    }

    if (clearSearchBtn) {
        clearSearchBtn.addEventListener('click', () => {
            if (searchInput) searchInput.value = '';
            clearSearchBtn.style.display = 'none';
            clearSearchSuggestions();
            toggleHomeAndYouTubeResults(true);
        });
    }

    if (searchBtn) {
        searchBtn.addEventListener('click', performSearch);
    }

   
   
    if (miniPlayPauseBtn) miniPlayPauseBtn.addEventListener('click', togglePlayPause);
    if (fullPlayPauseBtn) fullPlayPauseBtn.addEventListener('click', togglePlayPause);
    if (prevBtn) prevBtn.addEventListener('click', playPrevious);
    if (nextBtn) nextBtn.addEventListener('click', playNext);
    if (shuffleBtn) shuffleBtn.addEventListener('click', shufflePlaylist);

    // UI toggles
    if (themeToggleBtn) themeToggleBtn.addEventListener('click', toggleTheme);
    if (filterBtn) filterBtn.addEventListener('click', toggleFilterPanel);
    if (closeFilterBtn) closeFilterBtn.addEventListener('click', toggleFilterPanel);
    if (historyBtn) historyBtn.addEventListener('click', toggleHistoryPanel);
    if (closeHistoryBtn) closeHistoryBtn.addEventListener('click', toggleHistoryPanel);
    if (fullPlayerCloseBtn) fullPlayerCloseBtn.addEventListener('click', toggleFullPlayer);
    if (showModeBtn) showModeBtn.addEventListener('click', toggleShowModePanel);
    if (closeShowModeBtn) closeShowModeBtn.addEventListener('click', toggleShowModePanel);
    if (settingsButton) settingsButton.addEventListener('click', toggleSettingsPanel);
    if (closeSettingsBtn) closeSettingsBtn.addEventListener('click', toggleSettingsPanel);

    // Song grid
    if (songsGrid) {
        songsGrid.addEventListener('click', (e) => {
            const songCard = e.target.closest('.song-card');
            if (songCard) {
                e.preventDefault();
                const filename = songCard.dataset.filename;
                currentIndex = playlist.indexOf(filename);
                loadSong(filename);
            }
        });
    }

    // Embed button
    if (embedBtn) {
        embedBtn.addEventListener('click', () => {
            if (currentSong) {
                const songId = currentSong._src.split('/').pop().replace('.flac', '');
                const embedUrl = `${hostid}/v3/embed/details/sangeet/all//${songId}`;
                window.open(embedUrl, '_blank');
                
                const icon = embedBtn.querySelector('.material-icons');
                if (icon) {
                    const originalText = icon.textContent;
                    icon.textContent = 'open_in_new';
                    setTimeout(() => {
                        icon.textContent = originalText;
                    }, 2000);
                }
            } else {
                alert('No song is currently playing.');
            }
        });
    }

    // View more history
    if (viewMoreHistoryBtn) {
        viewMoreHistoryBtn.addEventListener('click', viewMoreHistory);
    }

    // Global key events
    document.addEventListener('keydown', (e) => {
        if (e.target !== searchInput) {
            if (e.code === 'Space') {
                e.preventDefault();
                togglePlayPause();
            } else if (e.code === 'ArrowLeft') {
                playPrevious();
            } else if (e.code === 'ArrowRight') {
                playNext();
            }
        }
    });

    // Mini player click to open full player
    const miniPlayer = document.getElementById('mini-player');
    if (miniPlayer) {
        miniPlayer.addEventListener('click', (e) => {
            if (!e.target.closest('.control-btn')) {
                toggleFullPlayer();
            }
        });
    }

    // Initialize theme
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        if (themeToggleBtn) {
            const icon = themeToggleBtn.querySelector('.material-icons');
            if (icon) icon.textContent = 'brightness_7';
        }
    }

    // Start clipboard check for YouTube links
    setInterval(checkClipboardForYouTube, 5000);
    clearProcessedYouTubeLinks();

    // Initialize filters
    const applyFiltersBtn = document.getElementById('apply-filters-btn');
    if (applyFiltersBtn) {
        applyFiltersBtn.addEventListener('click', applyFilters);
    }

    // Close stats panel
    const closeStatsPanel = document.getElementById('close-stats-panel');
    if (closeStatsPanel) {
        closeStatsPanel.addEventListener('click', closeStatsPanelFunction);
    }

    // Handle clicks outside the stats panel
    const statsPanel = document.getElementById('stats-panel');
    if (statsPanel) {
        statsPanel.addEventListener('click', (e) => {
            if (e.target === statsPanel) {
                closeStatsPanelFunction();
            }
        });
    }

    // Cleanup functionality
    const cleanupBtn = document.getElementById('cleanup-btn');
    const cleanupConfirmation = document.getElementById('cleanup-confirmation');
    const cleanupNo = document.getElementById('cleanup-no');
    const cleanupYes = document.getElementById('cleanup-yes');

    if (cleanupBtn) {
        cleanupBtn.addEventListener('click', () => {
            if (cleanupConfirmation) cleanupConfirmation.style.display = 'block';
        });
    }

    if (cleanupNo) {
        cleanupNo.addEventListener('click', () => {
            if (cleanupConfirmation) cleanupConfirmation.style.display = 'none';
        });
    }

    if (cleanupYes) {
        cleanupYes.addEventListener('click', performCleanup);
    }

    // Initialize custom check
    startCustomCheck();

    console.log('Sangeet music player initialized successfully');
});
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const settingsButton = document.getElementById('settings-button');
    const settingsPanel = document.getElementById('settings-panel');
    const closeSettingsBtn = document.getElementById('close-settings-btn');

    if (settingsButton && settingsPanel && closeSettingsBtn) {
        console.log('Settings elements found');
        
        settingsButton.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Settings button clicked');
            settingsPanel.classList.toggle('active');
        });

        closeSettingsBtn.addEventListener('click', function() {
            settingsPanel.classList.remove('active');
        });
    } else {
        console.error('One or more settings elements not found:');
        console.error('Settings button:', settingsButton);
        console.error('Settings panel:', settingsPanel);
        console.error('Close settings button:', closeSettingsBtn);
    }
    const embedBtn = document.getElementById('embed-btn');
    embedBtn.addEventListener('click', () => {
        if (currentSong) {
            const hostid = "{{ hostid }}";
        // Your existing JavaScript code
        const songId = currentSong._src.split('/').pop().replace('.flac', '');
        const embedUrl = `${hostid}/v3/embed/details/sangeet/all//${songId}`;
            
            // Open the URL in a new tab
            window.open(embedUrl, '_blank');

            // Visual feedback
            const icon = embedBtn.querySelector('.material-icons');
            const originalText = icon.textContent;
            icon.textContent = 'open_in_new';
            setTimeout(() => {
                icon.textContent = originalText;
            }, 2000);
        } else {
            alert('No song is currently playing.');
        }
    });

    
});
        document.addEventListener('DOMContentLoaded', () => {
          
            const cleanupBtn = document.getElementById('cleanup-btn');
            const cleanupConfirmation = document.getElementById('cleanup-confirmation');
            const cleanupNo = document.getElementById('cleanup-no');
            const cleanupYes = document.getElementById('cleanup-yes');
            const cleanupSpinner = document.getElementById('cleanup-spinner');
            const cleanupStatus = document.getElementById('cleanup-status');

      

            cleanupBtn.addEventListener('click', () => {
                cleanupConfirmation.style.display = 'block';
            });

            cleanupNo.addEventListener('click', () => {
                cleanupConfirmation.style.display = 'none';
            });

            cleanupYes.addEventListener('click', () => {
                cleanupConfirmation.style.display = 'none';
                cleanupSpinner.style.display = 'block';
                cleanupStatus.textContent = 'Cleaning up...';

                fetch('/cleanup', { method: 'POST' })
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        }
                        throw new Error('Cleanup failed');
                    })
                    .then(data => {
                        cleanupStatus.textContent = 'Cleanup successful. Reloading...';
                        setTimeout(() => {
                            location.reload(); // Reload the page to reflect changes
                        }, 1500);
                    })
                    .catch(error => {
                        cleanupStatus.textContent = 'Error: ' + error.message;
                        setTimeout(() => {
                            cleanupSpinner.style.display = 'none';
                        }, 2000);
                    });
            });
        });
    </script>

</body>

</html>